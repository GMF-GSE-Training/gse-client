import{a as z,b as ye}from"./chunk-BTG2KNMA.js";import"./chunk-OVD6HK5J.js";import{b as _e,c as q,d as D,e as U,f as W,g as H,k as Q,l as be,m as ve,n as Ce,o as y,p as Se,q as G,r as Pe,s as K,t as te,u as ie}from"./chunk-CNLSRUEW.js";import{a as F}from"./chunk-6UISH4EK.js";import{A as v,d as O,g as _,m as we,p as T,r as w,s as B,x as pe,z as b}from"./chunk-IPZRENOX.js";import{Cb as L,Db as N,Eb as j,Fb as x,Gb as l,Hb as fe,Ib as he,Kb as V,Lb as E,Mb as R,Na as f,O as ge,S as Y,Sa as m,Tb as le,X as $,Xa as h,Ya as ee,ab as k,ba as u,ca as g,hb as a,ka as A,nb as o,ob as s,pb as C,sb as S,vb as c,wb as P}from"./chunk-EYAWNPBD.js";var Re=["form"];function Oe(n,I){if(n&1&&(o(0,"div",18)(1,"span"),l(2),s()()),n&2){let i=P();f(2),fe(i.message)}}var ke=(()=>{class n{constructor(){this.loginError=!1,this.message="",this.loginRequest={identifier:"",password:""},this.isPassVisible=!1,this.isLoading=!1,this.formSubmit=new A}passVisible(){this.isPassVisible=!this.isPassVisible}onSubmit(){this.form.valid&&(this.loginRequest.identifier&&(this.loginRequest.identifier=this.loginRequest.identifier.trim()),this.formSubmit.emit(this.loginRequest))}static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275cmp=h({type:n,selectors:[["app-login-form"]],viewQuery:function(e,t){if(e&1&&L(Re,5),e&2){let r;N(r=j())&&(t.form=r.first)}},inputs:{loginError:"loginError",message:"message",loginRequest:"loginRequest",isPassVisible:"isPassVisible",isLoading:"isLoading"},outputs:{formSubmit:"formSubmit"},decls:26,vars:7,consts:[["form","ngForm"],["identifier","ngModel"],["password","ngModel"],[1,"form-container"],["class","error-message",4,"ngIf"],[1,"login-form",3,"ngSubmit"],["pageTitle","Login Account"],[1,"fa-solid","fa-user","user-icon"],["type","text","name","identifier","autocomplete","username","placeholder","Email atau No. Pegawai","required","",3,"ngModelChange","ngModel"],[1,"fa-solid","fa-lock","pass-icon"],[3,"togglePassClick","isPassVisible"],["name","password","autocomplete","current-password","placeholder","Password","required","",3,"ngModelChange","ngModel","type"],["routerLink","/password-reset",1,"auth-helper-links"],["routerLink","/verification",1,"auth-helper-links"],[1,"register-link-container"],[1,"register-link"],["routerLink","/register"],[1,"button",3,"type","disabled"],[1,"error-message"]],template:function(e,t){if(e&1){let r=S();o(0,"app-auth")(1,"div",3),k(2,Oe,3,1,"div",4),o(3,"form",5,0),c("ngSubmit",function(){return u(r),g(t.onSubmit())}),C(5,"app-title",6),o(6,"div"),C(7,"i",7),o(8,"input",8,1),R("ngModelChange",function(d){return u(r),E(t.loginRequest.identifier,d)||(t.loginRequest.identifier=d),g(d)}),s(),C(10,"i",9),o(11,"app-toggle-password-visibility",10),c("togglePassClick",function(){return u(r),g(t.passVisible())}),s(),o(12,"input",11,2),R("ngModelChange",function(d){return u(r),E(t.loginRequest.password,d)||(t.loginRequest.password=d),g(d)}),s()(),o(14,"div")(15,"a",12),l(16,"Lupa Password?"),s(),o(17,"a",13),l(18,"Belum Terverifikasi?"),s()(),o(19,"div",14)(20,"span",15),l(21,"Belum punya akun? "),o(22,"a",16),l(23,"Daftar"),s()()(),o(24,"app-blue-button",17),l(25,"Masuk"),s()()()()}if(e&2){let r=x(4);f(2),a("ngIf",t.loginError),f(6),V("ngModel",t.loginRequest.identifier),f(3),a("isPassVisible",t.isPassVisible),f(),V("ngModel",t.loginRequest.password),a("type",t.isPassVisible?"text":"password"),f(12),a("type","submit")("disabled",r.invalid||t.isLoading)}},dependencies:[z,G,Pe,K,B,_,O,y,H,_e,q,D,Q,W,U],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;min-height:100vh;overflow:auto;background:#fff;border-radius:16px;box-shadow:0 2px 8px #0000000f;padding:2em;box-sizing:border-box;overflow-x:hidden}.login-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;gap:2em;width:100%;max-width:520px;min-width:320px;padding:0 1.5em}input[_ngcontent-%COMP%]{font-size:1em;font-weight:700;padding-left:50px;border:none;outline:none;border-bottom:2px solid #000;height:40px}i[_ngcontent-%COMP%]{font-size:30px;position:relative;max-width:30px;max-height:30px}.user-icon[_ngcontent-%COMP%]{top:1.5em}.pass-icon[_ngcontent-%COMP%]{top:2.5em}app-toggle-password-visibility[_ngcontent-%COMP%]{position:relative;top:2em;left:90%}.register-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#02507e}.login-form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;font-weight:700;gap:10px}.register-link-container[_ngcontent-%COMP%]{align-items:center}.auth-helper-links[_ngcontent-%COMP%]{color:#02507e}.error-message[_ngcontent-%COMP%]{display:flex;justify-content:center;background-color:#ffeeba;padding:2px;position:relative;top:6em;color:red;font-weight:700;width:100%}.button[_ngcontent-%COMP%]{width:190px;height:45px}@media screen and (max-width: 1200px){.login-form[_ngcontent-%COMP%]{max-width:420px;padding:0 1em}}@media screen and (max-width: 900px){.form-container[_ngcontent-%COMP%]{padding:2em 1em}.login-form[_ngcontent-%COMP%]{max-width:100%;min-width:0;padding:0 .5em}}@media screen and (max-width: 600px){.form-container[_ngcontent-%COMP%]{padding:1em .5em}.login-form[_ngcontent-%COMP%]{max-width:100%;min-width:0;padding:0 .25em}}"]})}}return n})();var oe=(()=>{class n{constructor(i,e,t){this.router=i,this.authService=e,this.sweetalertService=t,this.isPassVisible=!1,this.loginRequest={identifier:"",password:""},this.loginError=!1,this.message="",this.isLoading=!1}passVisible(){this.isPassVisible=!this.isPassVisible}login(){this.isLoading=!0,this.authService.login(this.loginRequest).subscribe({next:i=>{let e=i.data;if(this.loginError=!1,this.isLoading=!1,e&&e.role?.name==="user"&&e.participant){let t=e.participant;if(!(t&&t.dateOfBirth&&t.placeOfBirth&&t.phoneNumber)){this.sweetalertService.alert("Peringatan","Data anda belum lengkap, silahkan lengkapi data terlebih dahulu","warning"),this.router.navigate(["/participants",t.id,"edit"]);return}}this.router.navigateByUrl("/dashboard")},error:i=>{console.log(i),this.loginError=!0,this.isLoading=!1,i.status===404?this.message="Akun Anda belum terdaftar. Silakan lakukan pendaftaran untuk mengakses layanan.":i.status===400?this.message="Kata sandi yang Anda masukkan salah.":i.status===403?this.message='Akun Anda belum terverifikasi. Silakan klik menu "Belum Terverifikasi?" untuk mengirim ulang email verifikasi.':this.message="Server sedang sibuk atau terjadi gangguan. Silakan coba beberapa saat lagi."}})}static{this.\u0275fac=function(e){return new(e||n)(m(w),m(b),m(v))}}static{this.\u0275cmp=h({type:n,selectors:[["app-login"]],decls:1,vars:5,consts:[[3,"formSubmit","loginRequest","loginError","message","isPassVisible","isLoading"]],template:function(e,t){e&1&&(o(0,"app-login-form",0),c("formSubmit",function(){return t.login()}),s()),e&2&&a("loginRequest",t.loginRequest)("loginError",t.loginError)("message",t.message)("isPassVisible",t.isPassVisible)("isLoading",t.isLoading)},dependencies:[_,we,y,ke],encapsulation:2})}}return n})();var se=(()=>{class n{constructor(i,e,t,r){this.authService=i,this.sweetalertService=e,this.handleErrorService=t,this.router=r,this.registerUserRequest={idNumber:"",nik:"",email:"",name:"",password:"",dinas:""},this.isSuccess=!1,this.registerMessage="",this.isLoading=!1}onRegister(i){this.cleanEmptyFields(i),this.sweetalertService.loading("Mohon tunggu","Proses..."),this.authService.register(i).subscribe({next:()=>{this.sweetalertService.close(),this.isSuccess=!0,this.sweetalertService.alert("Berhasil","Registrasi berhasil. Silakan login, dan cek email (inbox/spam) untuk verifikasi akun.","success").then(()=>this.router.navigateByUrl("/auth/login"))},error:e=>{console.log(e),this.sweetalertService.close(),this.isSuccess=!1,this.registerMessage=this.handleErrorService.getErrorMessage(e,["nik","email","nama","password"])}})}cleanEmptyFields(i){for(let e in i)i.hasOwnProperty(e)&&i[e]===""&&(i[e]=void 0)}register(){this.isLoading=!0,this.authService.register(this.registerUserRequest).subscribe({next:i=>{this.isLoading=!1,this.sweetalertService.alert("Berhasil","Registrasi berhasil. Tautan verifikasi telah dikirim ke email Anda. Periksa kotak masuk/spam.","success").then(()=>this.router.navigateByUrl("/auth/login"))},error:i=>{if(this.sweetalertService.close(),console.log(i),i.status===503){this.isLoading=!1,this.sweetalertService.alert("Peringatan",'Akun Anda sudah terdaftar, namun sistem gagal mengirim email verifikasi. Silakan verifikasi akun Anda di menu "Belum Terverifikasi?".',"warning").then(()=>this.router.navigateByUrl("/auth/verification"));return}this.isLoading=!1,this.handleErrorService.alertError(i)}})}static{this.\u0275fac=function(e){return new(e||n)(m(b),m(v),m(F),m(w))}}static{this.\u0275cmp=h({type:n,selectors:[["app-register"]],decls:1,vars:6,consts:[["blueButtonLabel","Daftar",3,"formSubmit","isRegister","isCreate","pageTitle","user","isSuccess","registerMessage"]],template:function(e,t){e&1&&(o(0,"app-user-form",0),c("formSubmit",function(p){return t.onRegister(p)}),s()),e&2&&a("isRegister",!0)("isCreate",!0)("pageTitle","Create Account")("user",t.registerUserRequest)("isSuccess",t.isSuccess)("registerMessage",t.registerMessage)},dependencies:[ye],encapsulation:2})}}return n})();var Te=["form"];function Fe(n,I){n&1&&(o(0,"div",11),C(1,"i",12),o(2,"span")(3,"b"),l(4,"Penting:"),s(),C(5,"br"),o(6,"span"),l(7,"\u{1F5D1}\uFE0F Akun yang belum diverifikasi dalam "),o(8,"b"),l(9,"24 jam"),s(),l(10," akan dihapus otomatis."),s(),C(11,"br"),o(12,"span"),l(13,"\u{1F4E7} Jangan lupa cek folder "),o(14,"b"),l(15,"Inbox"),s(),l(16," atau "),o(17,"b"),l(18,"Spam"),s(),l(19," Anda."),s()()())}var Z=(()=>{class n{constructor(){this.pageTitle="",this.isSubmitted=!1,this.submitError=!1,this.data={email:""},this.formSubmit=new A}onSubmit(){this.form.valid&&this.formSubmit.emit(this.data)}static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275cmp=h({type:n,selectors:[["app-email-form"]],viewQuery:function(e,t){if(e&1&&L(Te,5),e&2){let r;N(r=j())&&(t.form=r.first)}},inputs:{pageTitle:"pageTitle",isSubmitted:"isSubmitted",submitError:"submitError",data:"data"},outputs:{formSubmit:"formSubmit"},decls:14,vars:6,consts:[["form","ngForm"],["email","ngModel"],[1,"form-container"],[1,"form",3,"ngSubmit"],[3,"pageTitle"],["class","alert alert-warning","style","margin-bottom: 15px; padding: 10px; border-radius: 5px; background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba;",4,"ngIf"],[1,"input-container"],["label","Email","type","email","autocomplete","email","inputMode","email","placeholder","Email yang terdaftar","name","email","required","",1,"input",3,"ngModelChange","ngModel","isRequired","email"],[1,"buttons-container"],["type","button","routerLink","/login",1,"button"],["type","submit",1,"button",3,"disabled"],[1,"alert","alert-warning",2,"margin-bottom","15px","padding","10px","border-radius","5px","background-color","#fff3cd","color","#856404","border","1px solid #ffeeba"],[1,"fa-solid","fa-exclamation-triangle",2,"margin-right","5px"]],template:function(e,t){if(e&1){let r=S();o(0,"app-auth")(1,"div",2)(2,"form",3,0),c("ngSubmit",function(){return u(r),g(t.onSubmit())}),C(4,"app-title",4),k(5,Fe,20,0,"div",5),o(6,"div",6)(7,"app-base-input",7,1),R("ngModelChange",function(d){return u(r),E(t.data.email,d)||(t.data.email=d),g(d)}),s()(),o(9,"div",8)(10,"app-white-button",9),l(11,"Kembali"),s(),o(12,"app-blue-button",10),l(13,"Kirim"),s()()()()()}if(e&2){let r=x(3);f(4),a("pageTitle",t.pageTitle),f(),a("ngIf",t.pageTitle==="Account Verification"),f(2),V("ngModel",t.data.email),a("isRequired",!0)("email",!0),f(5),a("disabled",r.invalid)}},dependencies:[G,te,ie,K,y,H,q,D,Q,be,W,U,_,O,z,B],styles:[".form-container[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;align-items:center;justify-content:center}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;padding:0 2em}.input-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%}.buttons-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:4em;width:100%;margin-top:2em}.button[_ngcontent-%COMP%]{width:190px;height:45px}",".form-container[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;align-items:center;justify-content:center}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;width:75%;padding:0 2em}.input-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%}.buttons-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:4em;width:100%;margin-top:2em}.button[_ngcontent-%COMP%]{width:190px;height:45px}.input[_ngcontent-%COMP%]{width:100%}.isRegistered[_ngcontent-%COMP%]{margin-top:25px;font-weight:700}.isRegistered[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#02507e}.error-message-container[_ngcontent-%COMP%]{width:100%}.error-message[_ngcontent-%COMP%]{color:red;margin-left:15px;margin-top:3px;font-size:14px}.success-message[_ngcontent-%COMP%]{background-color:#90ee90;padding:2px;margin-top:3px;color:#000}.register-message[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;background-color:#90ee90;padding:2px;position:relative;top:1em;color:#000;font-weight:700}@media (max-width: 768px){.form[_ngcontent-%COMP%]{width:100%}}"]})}}return n})();var ae=(()=>{class n{constructor(i,e,t,r,p){this.authService=i,this.sweetalertService=e,this.route=t,this.router=r,this.errorHandlerService=p,this.data={email:""},this.errorMessage=""}ngOnInit(){this.route.queryParams.subscribe(i=>{if(i.error){let e=i.error;this.sweetalertService.alert("Gagal",e,"error"),e&&this.router.navigate([],{relativeTo:this.route,queryParams:{error:null},queryParamsHandling:"merge"})}})}onSubmit(i){this.sweetalertService.loading("Mohon tunggu","Proses..."),this.authService.forgotPassword(i).subscribe({next:()=>{this.sweetalertService.alert("","Permintaan reset password telah diproses. Silakan cek email Anda untuk instruksi selanjutnya.","success")},error:e=>{console.log(e),this.errorHandlerService.alertError(e)}})}static{this.\u0275fac=function(e){return new(e||n)(m(b),m(v),m(T),m(w),m(F))}}static{this.\u0275cmp=h({type:n,selectors:[["app-forgot-password"]],decls:1,vars:1,consts:[["pageTitle","Forgot Password",3,"formSubmit","data"]],template:function(e,t){e&1&&(o(0,"app-email-form",0),c("formSubmit",function(p){return t.onSubmit(p)}),s()),e&2&&a("data",t.data)},dependencies:[Z],encapsulation:2})}}return n})();var Ie=["form"];function Ae(n,I){if(n&1&&(o(0,"span",14),l(1),s()),n&2){let i=P();f(),he(" ",i.message," ")}}var xe=(()=>{class n{constructor(){this.data={newPassword:"",confirmNewPassword:""},this.passwordMismatch=!1,this.message="",this.isNewPassVisible=!1,this.isConfirmNewPassVisible=!1,this.formSubmit=new A}newPassVisible(){this.isNewPassVisible=!this.isNewPassVisible}confirmNewPassVisible(){this.isConfirmNewPassVisible=!this.isConfirmNewPassVisible}checkPasswordMatch(){this.data.newPassword&&this.data.confirmNewPassword&&(this.passwordMismatch=this.data.newPassword!==this.data.confirmNewPassword,this.passwordMismatch?this.message="Password baru tidak sama":this.message="")}onSubmit(){this.form.valid&&this.formSubmit.emit(this.data)}static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275cmp=h({type:n,selectors:[["app-reset-password-form"]],viewQuery:function(e,t){if(e&1&&L(Ie,5),e&2){let r;N(r=j())&&(t.form=r.first)}},inputs:{data:"data"},outputs:{formSubmit:"formSubmit"},decls:17,vars:10,consts:[["form","ngForm"],["newPassword","ngModel"],["confirmNewPassword","ngModel"],[1,"form-container"],[1,"form",3,"ngSubmit"],["pageTitle","Reset Password"],[1,"input-container"],["label","Password baru","autocomplete","new-password","inputMode","text","placeholder","Password baru","name","newPassword","required","","minLength","8","minLengthErrorMessage","Password harus berisi minimal 8 karakter dengan kombinasi huruf besar, huruf kecil, dan angka","pattern","^(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9]).+$","patternErrorMessage","Password harus berisi minimal 8 karakter dengan kombinasi huruf besar, huruf kecil, dan angka",1,"input",3,"ngModelChange","togglePassClick","type","ngModel","isPassVisible","isRequired"],["label","Konfirmasi Password Baru","autocomplete","new-password","inputMode","text","placeholder","Konfirmasi password baru","name","confirmNewPassword","required","","minLength","8","minlength","8","minLengthErrorMessage","Password harus berisi minimal 8 karakter dengan kombinasi huruf besar, huruf kecil, dan angka","pattern","^(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9]).+$","patternErrorMessage","Password harus berisi minimal 8 karakter dengan kombinasi huruf besar, huruf kecil, dan angka",1,"input",3,"ngModelChange","togglePassClick","type","ngModel","isPassVisible","isRequired"],[1,"error-message-container"],["class","error-message",4,"ngIf"],[1,"buttons-container"],["type","button","routerLink","/dashboard",1,"button"],["type","submit",1,"button",3,"disabled"],[1,"error-message"]],template:function(e,t){if(e&1){let r=S();o(0,"app-auth")(1,"div",3)(2,"form",4,0),c("ngSubmit",function(){return u(r),g(t.onSubmit())}),C(4,"app-title",5),o(5,"div",6)(6,"app-base-input",7,1),R("ngModelChange",function(d){return u(r),E(t.data.newPassword,d)||(t.data.newPassword=d),g(d)}),c("togglePassClick",function(){return u(r),g(t.newPassVisible())})("ngModelChange",function(){return u(r),g(t.checkPasswordMatch())}),s(),o(8,"app-base-input",8,2),R("ngModelChange",function(d){return u(r),E(t.data.confirmNewPassword,d)||(t.data.confirmNewPassword=d),g(d)}),c("togglePassClick",function(){return u(r),g(t.confirmNewPassVisible())})("ngModelChange",function(){return u(r),g(t.checkPasswordMatch())}),s(),o(10,"div",9),k(11,Ae,2,1,"span",10),s()(),o(12,"div",11)(13,"app-white-button",12),l(14,"Kembali"),s(),o(15,"app-blue-button",13),l(16,"Simpan"),s()()()()()}if(e&2){let r=x(3);f(6),a("type",t.isNewPassVisible?"text":"password"),V("ngModel",t.data.newPassword),a("isPassVisible",t.isNewPassVisible)("isRequired",!0),f(2),a("type",t.isConfirmNewPassVisible?"text":"password"),V("ngModel",t.data.confirmNewPassword),a("isPassVisible",t.isConfirmNewPassVisible)("isRequired",!0),f(3),a("ngIf",t.passwordMismatch&&r.valid),f(4),a("disabled",r.invalid||t.passwordMismatch)}},dependencies:[z,G,te,ie,K,y,H,q,D,Q,ve,Ce,W,U,_,O,B],styles:[".form-container[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;align-items:center;justify-content:center}.buttons-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:4em;width:100%;margin-top:2em}.button[_ngcontent-%COMP%]{width:190px;height:45px}.reset-password-message[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;background-color:#90ee90;padding:2px;position:relative;top:1em;color:#000;font-weight:700}.error-message[_ngcontent-%COMP%]{color:red;margin-left:15px;margin-top:3px;font-size:14px}",".form-container[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;align-items:center;justify-content:center}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;width:75%;padding:0 2em}.input-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%}.buttons-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:4em;width:100%;margin-top:2em}.button[_ngcontent-%COMP%]{width:190px;height:45px}.input[_ngcontent-%COMP%]{width:100%}.isRegistered[_ngcontent-%COMP%]{margin-top:25px;font-weight:700}.isRegistered[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#02507e}.error-message-container[_ngcontent-%COMP%]{width:100%}.error-message[_ngcontent-%COMP%]{color:red;margin-left:15px;margin-top:3px;font-size:14px}.success-message[_ngcontent-%COMP%]{background-color:#90ee90;padding:2px;margin-top:3px;color:#000}.register-message[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;background-color:#90ee90;padding:2px;position:relative;top:1em;color:#000;font-weight:700}@media (max-width: 768px){.form[_ngcontent-%COMP%]{width:100%}}"]})}}return n})();var me=(()=>{class n{constructor(i,e,t,r,p){this.route=i,this.router=e,this.authService=t,this.sweetalertService=r,this.errorHandlerService=p,this.data={token:this.route.snapshot.paramMap.get("token")||"",newPassword:"",confirmNewPassword:""}}onResetPassword(i){this.authService.resetPassword(i).subscribe({next:()=>{this.sweetalertService.alert("Berhasil!","Password berhasil diperbarui","success"),this.router.navigateByUrl("/login")},error:e=>{console.log(e),console.log(e),this.errorHandlerService.alertError(e)}})}static{this.\u0275fac=function(e){return new(e||n)(m(T),m(w),m(b),m(v),m(F))}}static{this.\u0275cmp=h({type:n,selectors:[["app-reset-password"]],decls:1,vars:1,consts:[[3,"formSubmit","data"]],template:function(e,t){e&1&&(o(0,"app-reset-password-form",0),c("formSubmit",function(p){return t.onResetPassword(p)}),s()),e&2&&a("data",t.data)},dependencies:[xe],encapsulation:2})}}return n})();var X=(()=>{class n{constructor(i,e,t,r,p){this.authService=i,this.sweetalertService=e,this.errorHandlerService=t,this.route=r,this.router=p,this.data={email:""},this.message=""}ngOnInit(){this.route.queryParams.subscribe(i=>{let e=i.token;e&&this.verifyAccount(e);let t=sessionStorage.getItem("unverified_email");t&&(this.data.email=t,sessionStorage.removeItem("unverified_email"))})}onSubmit(i){this.sweetalertService.loading("Mohon tunggu","Proses..."),this.authService.resendVerification(i.email).subscribe({next:()=>{this.sweetalertService.close(),this.sweetalertService.alert("Berhasil","Tautan verifikasi telah dikirim ke email Anda. Periksa kotak masuk/spam.","success")},error:e=>{this.sweetalertService.close(),console.log(e),this.errorHandlerService.alertError(e)}})}verifyAccount(i){this.sweetalertService.loading("Mohon tunggu","Memverifikasi akun Anda..."),this.authService.verifyAccount(i).subscribe({next:e=>{this.sweetalertService.close(),this.sweetalertService.alert("Verifikasi Berhasil","Akun berhasil diverifikasi. Mengarahkan ke Dashboard...","success").then(()=>{this.authService.me().pipe(ge(t=>{this.authService.setUserProfile(t.data),console.log("AccountVerificationComponent: User profile updated in localStorage via authService.me()",this.authService.getUserProfile())})).subscribe({complete:()=>{console.log("AccountVerificationComponent: Navigating to dashboard after successful verification and profile update."),this.router.navigateByUrl("/dashboard")},error:t=>{console.error("AccountVerificationComponent: Error fetching updated user profile:",t),this.router.navigateByUrl("/dashboard")}})})},error:e=>{this.sweetalertService.close(),e.status===400&&e.error?.message?.includes("Token tidak valid atau telah kadaluarsa")?this.sweetalertService.alert("Verifikasi Gagal","Tautan verifikasi tidak valid/kadaluarsa. Minta tautan baru di bawah.","error"):this.errorHandlerService.alertError(e)}})}static{this.\u0275fac=function(e){return new(e||n)(m(b),m(v),m(F),m(T),m(w))}}static{this.\u0275cmp=h({type:n,selectors:[["app-account-verification"]],decls:1,vars:1,consts:[["pageTitle","Account Verification",3,"formSubmit","data"]],template:function(e,t){e&1&&(o(0,"app-email-form",0),c("formSubmit",function(p){return t.onSubmit(p)}),s()),e&2&&a("data",t.data)},dependencies:[Z],encapsulation:2})}}return n})();function Le(n,I){if(n&1){let i=S();o(0,"div")(1,"h2"),l(2,"Verifikasi Berhasil"),s(),o(3,"p"),l(4,"Akun Anda berhasil diverifikasi. Silakan login untuk melanjutkan."),s(),o(5,"button",3),c("click",function(){u(i);let t=P();return g(t.goToLogin())}),l(6,"Ke Login"),s()()}}function Ne(n,I){if(n&1){let i=S();o(0,"div")(1,"h2"),l(2,"Verifikasi Gagal"),s(),o(3,"p"),l(4,"Tautan verifikasi tidak valid atau sudah kadaluarsa."),s(),o(5,"button",3),c("click",function(){u(i);let t=P(2);return g(t.goToResend())}),l(6,"Minta Ulang Verifikasi"),s()()}}function je(n,I){if(n&1&&k(0,Ne,7,0,"div",2),n&2){let i=P(),e=x(4);a("ngIf",i.status==="failed")("ngIfElse",e)}}function Be(n,I){if(n&1){let i=S();o(0,"app-email-form",4),c("formSubmit",function(t){u(i);let r=P();return g(r.onSubmit(t))}),s()}if(n&2){let i=P();a("data",i.data)}}var Ve=(()=>{class n{constructor(i,e){this.route=i,this.router=e,this.status=null,this.data={}}ngOnInit(){this.route.queryParams.subscribe(i=>{let e=i.status;e==="success"||e==="failed"?this.status=e:this.status=null})}goToLogin(){this.router.navigateByUrl("/login")}goToResend(){this.router.navigateByUrl("/auth/account-verification")}onSubmit(i){}static{this.\u0275fac=function(e){return new(e||n)(m(T),m(w))}}static{this.\u0275cmp=h({type:n,selectors:[["app-verification"]],decls:5,vars:2,consts:[["failedBlock",""],["defaultBlock",""],[4,"ngIf","ngIfElse"],[3,"click"],["pageTitle","Account Verification",3,"formSubmit","data"]],template:function(e,t){if(e&1&&k(0,Le,7,0,"div",2)(1,je,1,2,"ng-template",null,0,le)(3,Be,1,1,"ng-template",null,1,le),e&2){let r=x(2);a("ngIf",t.status==="success")("ngIfElse",r)}},dependencies:[_,O,Z],styles:["h2[_ngcontent-%COMP%]{color:#2e7d32;margin-bottom:8px}p[_ngcontent-%COMP%]{margin-bottom:16px}button[_ngcontent-%COMP%]{background:#1976d2;color:#fff;border:none;padding:8px 16px;border-radius:4px;cursor:pointer}button[_ngcontent-%COMP%]:hover{background:#1565c0}div[ng-reflect-ng-if=false][_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#c62828}"]})}}return n})();var ue=(n,I)=>{let i=$(w),e=$(v),t=$(b),r="/auth/login",p=()=>(i.navigateByUrl(r),!1);return t.getUserProfile()?(i.navigateByUrl("/dashboard"),!1):!0};var qe=[{path:"login",component:oe,canActivate:[ue]},{path:"register",component:se,canActivate:[ue]},{path:"password-reset",component:ae},{path:"reset/:token",component:me},{path:"verification",component:X},{path:"verify",component:X},{path:"verified",component:Ve},{path:"",redirectTo:"login",pathMatch:"full"}],Ee=(()=>{class n{static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275mod=ee({type:n})}static{this.\u0275inj=Y({imports:[pe.forChild(qe),pe]})}}return n})();var ui=(()=>{class n{static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275mod=ee({type:n})}static{this.\u0275inj=Y({imports:[_,y,Se,Ee,oe,se,ae,me,X]})}}return n})();export{ui as AuthModule};
