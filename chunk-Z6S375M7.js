import{a as H,b as Se}from"./chunk-N4JXR3V3.js";import"./chunk-Y6NEXZML.js";import{b as he,c as I,d as q,e as B,f as D,g as U,k as W,l as we,m as be,n as ve,o as S,p as Ce,q as Q,r as _e,s as z,t as Y,u as $}from"./chunk-3ZPOVZV4.js";import{a as x}from"./chunk-UNNZNCRT.js";import{A as v,d as A,g as _,m as fe,p as N,r as w,s as j,x as le,z as b}from"./chunk-FVP7M3JJ.js";import{Cb as O,Db as F,Eb as T,Fb as L,Gb as p,Hb as ue,Ib as ge,Kb as y,Lb as M,Mb as k,Na as u,O as ce,S as K,Sa as m,X as Z,Xa as h,Ya as J,ab as R,ba as g,ca as f,hb as l,ka as V,nb as o,ob as s,pb as C,sb as E,vb as c,wb as X}from"./chunk-NQSGFRSF.js";var Ve=["form"];function Re(r,me){if(r&1&&(o(0,"div",18)(1,"span"),p(2),s()()),r&2){let i=X();u(2),ue(i.message)}}var Me=(()=>{class r{constructor(){this.loginError=!1,this.message="",this.loginRequest={identifier:"",password:""},this.isPassVisible=!1,this.isLoading=!1,this.formSubmit=new V}passVisible(){this.isPassVisible=!this.isPassVisible}onSubmit(){this.form.valid&&(this.loginRequest.identifier&&(this.loginRequest.identifier=this.loginRequest.identifier.trim()),this.formSubmit.emit(this.loginRequest))}static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275cmp=h({type:r,selectors:[["app-login-form"]],viewQuery:function(e,t){if(e&1&&O(Ve,5),e&2){let n;F(n=T())&&(t.form=n.first)}},inputs:{loginError:"loginError",message:"message",loginRequest:"loginRequest",isPassVisible:"isPassVisible",isLoading:"isLoading"},outputs:{formSubmit:"formSubmit"},decls:26,vars:7,consts:[["form","ngForm"],["identifier","ngModel"],["password","ngModel"],[1,"form-container"],["class","error-message",4,"ngIf"],[1,"login-form",3,"ngSubmit"],["pageTitle","Login Account"],[1,"fa-solid","fa-user","user-icon"],["type","text","name","identifier","autocomplete","username","placeholder","Email atau No. Pegawai","required","",3,"ngModelChange","ngModel"],[1,"fa-solid","fa-lock","pass-icon"],[3,"togglePassClick","isPassVisible"],["name","password","autocomplete","current-password","placeholder","Password","required","",3,"ngModelChange","ngModel","type"],["routerLink","/password-reset",1,"auth-helper-links"],["routerLink","/verification",1,"auth-helper-links"],[1,"register-link-container"],[1,"register-link"],["routerLink","/register"],[1,"button",3,"type","disabled"],[1,"error-message"]],template:function(e,t){if(e&1){let n=E();o(0,"app-auth")(1,"div",3),R(2,Re,3,1,"div",4),o(3,"form",5,0),c("ngSubmit",function(){return g(n),f(t.onSubmit())}),C(5,"app-title",6),o(6,"div"),C(7,"i",7),o(8,"input",8,1),k("ngModelChange",function(d){return g(n),M(t.loginRequest.identifier,d)||(t.loginRequest.identifier=d),f(d)}),s(),C(10,"i",9),o(11,"app-toggle-password-visibility",10),c("togglePassClick",function(){return g(n),f(t.passVisible())}),s(),o(12,"input",11,2),k("ngModelChange",function(d){return g(n),M(t.loginRequest.password,d)||(t.loginRequest.password=d),f(d)}),s()(),o(14,"div")(15,"a",12),p(16,"Lupa Password?"),s(),o(17,"a",13),p(18,"Belum Terverifikasi?"),s()(),o(19,"div",14)(20,"span",15),p(21,"Belum punya akun? "),o(22,"a",16),p(23,"Daftar"),s()()(),o(24,"app-blue-button",17),p(25,"Masuk"),s()()()()}if(e&2){let n=L(4);u(2),l("ngIf",t.loginError),u(6),y("ngModel",t.loginRequest.identifier),u(3),l("isPassVisible",t.isPassVisible),u(),y("ngModel",t.loginRequest.password),l("type",t.isPassVisible?"text":"password"),u(12),l("type","submit")("disabled",n.invalid||t.isLoading)}},dependencies:[H,Q,_e,z,j,_,A,S,U,he,I,q,W,D,B],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;min-height:100vh;overflow:auto;background:#fff;border-radius:16px;box-shadow:0 2px 8px #0000000f;padding:2em;box-sizing:border-box;overflow-x:hidden}.login-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;gap:2em;width:100%;max-width:520px;min-width:320px;padding:0 1.5em}input[_ngcontent-%COMP%]{font-size:1em;font-weight:700;padding-left:50px;border:none;outline:none;border-bottom:2px solid #000;height:40px}i[_ngcontent-%COMP%]{font-size:30px;position:relative;max-width:30px;max-height:30px}.user-icon[_ngcontent-%COMP%]{top:1.5em}.pass-icon[_ngcontent-%COMP%]{top:2.5em}app-toggle-password-visibility[_ngcontent-%COMP%]{position:relative;top:2em;left:90%}.register-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#02507e}.login-form[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;font-weight:700;gap:10px}.register-link-container[_ngcontent-%COMP%]{align-items:center}.auth-helper-links[_ngcontent-%COMP%]{color:#02507e}.error-message[_ngcontent-%COMP%]{display:flex;justify-content:center;background-color:#ffeeba;padding:2px;position:relative;top:6em;color:red;font-weight:700;width:100%}.button[_ngcontent-%COMP%]{width:190px;height:45px}@media screen and (max-width: 1200px){.login-form[_ngcontent-%COMP%]{max-width:420px;padding:0 1em}}@media screen and (max-width: 900px){.form-container[_ngcontent-%COMP%]{padding:2em 1em}.login-form[_ngcontent-%COMP%]{max-width:100%;min-width:0;padding:0 .5em}}@media screen and (max-width: 600px){.form-container[_ngcontent-%COMP%]{padding:1em .5em}.login-form[_ngcontent-%COMP%]{max-width:100%;min-width:0;padding:0 .25em}}"]})}}return r})();var re=(()=>{class r{constructor(i,e,t){this.router=i,this.authService=e,this.sweetalertService=t,this.isPassVisible=!1,this.loginRequest={identifier:"",password:""},this.loginError=!1,this.message="",this.isLoading=!1}passVisible(){this.isPassVisible=!this.isPassVisible}login(){this.isLoading=!0,this.authService.login(this.loginRequest).subscribe({next:i=>{let e=i.data;if(this.loginError=!1,this.isLoading=!1,e&&e.role?.name==="user"&&e.participant){let t=e.participant;if(!(t&&t.dateOfBirth&&t.placeOfBirth&&t.phoneNumber)){this.sweetalertService.alert("Peringatan","Data anda belum lengkap, silahkan lengkapi data terlebih dahulu","warning"),this.router.navigate(["/participants",t.id,"edit"]);return}}this.router.navigateByUrl("/dashboard")},error:i=>{console.log(i),this.loginError=!0,this.isLoading=!1,i.status===404?this.message="Akun Anda belum terdaftar. Silakan lakukan pendaftaran untuk mengakses layanan.":i.status===400?this.message="Kata sandi yang Anda masukkan salah.":i.status===403?this.message='Akun Anda belum terverifikasi. Silakan klik menu "Belum Terverifikasi?" untuk mengirim ulang email verifikasi.':this.message="Server sedang sibuk atau terjadi gangguan. Silakan coba beberapa saat lagi."}})}static{this.\u0275fac=function(e){return new(e||r)(m(w),m(b),m(v))}}static{this.\u0275cmp=h({type:r,selectors:[["app-login"]],decls:1,vars:5,consts:[[3,"formSubmit","loginRequest","loginError","message","isPassVisible","isLoading"]],template:function(e,t){e&1&&(o(0,"app-login-form",0),c("formSubmit",function(){return t.login()}),s()),e&2&&l("loginRequest",t.loginRequest)("loginError",t.loginError)("message",t.message)("isPassVisible",t.isPassVisible)("isLoading",t.isLoading)},dependencies:[_,fe,S,Me],encapsulation:2})}}return r})();var ne=(()=>{class r{constructor(i,e,t,n){this.authService=i,this.sweetalertService=e,this.handleErrorService=t,this.router=n,this.registerUserRequest={idNumber:"",nik:"",email:"",name:"",password:"",dinas:""},this.isSuccess=!1,this.registerMessage="",this.isLoading=!1}onRegister(i){this.cleanEmptyFields(i),this.sweetalertService.loading("Mohon tunggu","Proses..."),this.authService.register(i).subscribe({next:()=>{this.sweetalertService.close(),this.isSuccess=!0,this.sweetalertService.alert("Berhasil","Registrasi berhasil. Silakan login, dan cek email (inbox/spam) untuk verifikasi akun.","success").then(()=>this.router.navigateByUrl("/auth/login"))},error:e=>{console.log(e),this.sweetalertService.close(),this.isSuccess=!1,this.registerMessage=this.handleErrorService.getErrorMessage(e,["nik","email","nama","password"])}})}cleanEmptyFields(i){for(let e in i)i.hasOwnProperty(e)&&i[e]===""&&(i[e]=void 0)}register(){this.isLoading=!0,this.authService.register(this.registerUserRequest).subscribe({next:i=>{this.isLoading=!1,this.sweetalertService.alert("Berhasil","Registrasi berhasil. Tautan verifikasi telah dikirim ke email Anda. Periksa kotak masuk/spam.","success").then(()=>this.router.navigateByUrl("/auth/login"))},error:i=>{if(this.sweetalertService.close(),console.log(i),i.status===503){this.isLoading=!1,this.sweetalertService.alert("Peringatan",'Akun Anda sudah terdaftar, namun sistem gagal mengirim email verifikasi. Silakan verifikasi akun Anda di menu "Belum Terverifikasi?".',"warning").then(()=>this.router.navigateByUrl("/auth/verification"));return}this.isLoading=!1,this.handleErrorService.alertError(i)}})}static{this.\u0275fac=function(e){return new(e||r)(m(b),m(v),m(x),m(w))}}static{this.\u0275cmp=h({type:r,selectors:[["app-register"]],decls:1,vars:6,consts:[["blueButtonLabel","Daftar",3,"formSubmit","isRegister","isCreate","pageTitle","user","isSuccess","registerMessage"]],template:function(e,t){e&1&&(o(0,"app-user-form",0),c("formSubmit",function(a){return t.onRegister(a)}),s()),e&2&&l("isRegister",!0)("isCreate",!0)("pageTitle","Create Account")("user",t.registerUserRequest)("isSuccess",t.isSuccess)("registerMessage",t.registerMessage)},dependencies:[Se],encapsulation:2})}}return r})();var Ee=["form"];function Oe(r,me){r&1&&(o(0,"div",11),C(1,"i",12),o(2,"span")(3,"b"),p(4,"Penting:"),s(),C(5,"br"),o(6,"span"),p(7,"\u{1F5D1}\uFE0F Akun yang belum diverifikasi dalam "),o(8,"b"),p(9,"24 jam"),s(),p(10," akan dihapus otomatis."),s(),C(11,"br"),o(12,"span"),p(13,"\u{1F4E7} Jangan lupa cek folder "),o(14,"b"),p(15,"Inbox"),s(),p(16," atau "),o(17,"b"),p(18,"Spam"),s(),p(19," Anda."),s()()())}var oe=(()=>{class r{constructor(){this.pageTitle="",this.isSubmitted=!1,this.submitError=!1,this.data={email:""},this.formSubmit=new V}onSubmit(){this.form.valid&&this.formSubmit.emit(this.data)}static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275cmp=h({type:r,selectors:[["app-email-form"]],viewQuery:function(e,t){if(e&1&&O(Ee,5),e&2){let n;F(n=T())&&(t.form=n.first)}},inputs:{pageTitle:"pageTitle",isSubmitted:"isSubmitted",submitError:"submitError",data:"data"},outputs:{formSubmit:"formSubmit"},decls:14,vars:6,consts:[["form","ngForm"],["email","ngModel"],[1,"form-container"],[1,"form",3,"ngSubmit"],[3,"pageTitle"],["class","alert alert-warning","style","margin-bottom: 15px; padding: 10px; border-radius: 5px; background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba;",4,"ngIf"],[1,"input-container"],["label","Email","type","email","autocomplete","email","inputMode","email","placeholder","Email yang terdaftar","name","email","required","",1,"input",3,"ngModelChange","ngModel","isRequired","email"],[1,"buttons-container"],["type","button","routerLink","/login",1,"button"],["type","submit",1,"button",3,"disabled"],[1,"alert","alert-warning",2,"margin-bottom","15px","padding","10px","border-radius","5px","background-color","#fff3cd","color","#856404","border","1px solid #ffeeba"],[1,"fa-solid","fa-exclamation-triangle",2,"margin-right","5px"]],template:function(e,t){if(e&1){let n=E();o(0,"app-auth")(1,"div",2)(2,"form",3,0),c("ngSubmit",function(){return g(n),f(t.onSubmit())}),C(4,"app-title",4),R(5,Oe,20,0,"div",5),o(6,"div",6)(7,"app-base-input",7,1),k("ngModelChange",function(d){return g(n),M(t.data.email,d)||(t.data.email=d),f(d)}),s()(),o(9,"div",8)(10,"app-white-button",9),p(11,"Kembali"),s(),o(12,"app-blue-button",10),p(13,"Kirim"),s()()()()()}if(e&2){let n=L(3);u(4),l("pageTitle",t.pageTitle),u(),l("ngIf",t.pageTitle==="Account Verification"),u(2),y("ngModel",t.data.email),l("isRequired",!0)("email",!0),u(5),l("disabled",n.invalid)}},dependencies:[Q,Y,$,z,S,U,I,q,W,we,D,B,_,A,H,j],styles:[".form-container[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;align-items:center;justify-content:center}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;padding:0 2em}.input-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%}.buttons-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:4em;width:100%;margin-top:2em}.button[_ngcontent-%COMP%]{width:190px;height:45px}",".form-container[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;align-items:center;justify-content:center}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;width:75%;padding:0 2em}.input-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%}.buttons-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:4em;width:100%;margin-top:2em}.button[_ngcontent-%COMP%]{width:190px;height:45px}.input[_ngcontent-%COMP%]{width:100%}.isRegistered[_ngcontent-%COMP%]{margin-top:25px;font-weight:700}.isRegistered[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#02507e}.error-message-container[_ngcontent-%COMP%]{width:100%}.error-message[_ngcontent-%COMP%]{color:red;margin-left:15px;margin-top:3px;font-size:14px}.success-message[_ngcontent-%COMP%]{background-color:#90ee90;padding:2px;margin-top:3px;color:#000}.register-message[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;background-color:#90ee90;padding:2px;position:relative;top:1em;color:#000;font-weight:700}@media (max-width: 768px){.form[_ngcontent-%COMP%]{width:100%}}"]})}}return r})();var se=(()=>{class r{constructor(i,e,t,n,a){this.authService=i,this.sweetalertService=e,this.route=t,this.router=n,this.errorHandlerService=a,this.data={email:""},this.errorMessage=""}ngOnInit(){this.route.queryParams.subscribe(i=>{if(i.error){let e=i.error;this.sweetalertService.alert("Gagal",e,"error"),e&&this.router.navigate([],{relativeTo:this.route,queryParams:{error:null},queryParamsHandling:"merge"})}})}onSubmit(i){this.sweetalertService.loading("Mohon tunggu","Proses..."),this.authService.forgotPassword(i).subscribe({next:()=>{this.sweetalertService.alert("","Permintaan reset password telah diproses. Silakan cek email Anda untuk instruksi selanjutnya.","success")},error:e=>{console.log(e),this.errorHandlerService.alertError(e)}})}static{this.\u0275fac=function(e){return new(e||r)(m(b),m(v),m(N),m(w),m(x))}}static{this.\u0275cmp=h({type:r,selectors:[["app-forgot-password"]],decls:1,vars:1,consts:[["pageTitle","Forgot password",3,"formSubmit","data"]],template:function(e,t){e&1&&(o(0,"app-email-form",0),c("formSubmit",function(a){return t.onSubmit(a)}),s()),e&2&&l("data",t.data)},dependencies:[oe],encapsulation:2})}}return r})();var Fe=["form"];function Te(r,me){if(r&1&&(o(0,"span",14),p(1),s()),r&2){let i=X();u(),ge(" ",i.message," ")}}var ke=(()=>{class r{constructor(){this.data={newPassword:"",confirmNewPassword:""},this.passwordMismatch=!1,this.message="",this.isNewPassVisible=!1,this.isConfirmNewPassVisible=!1,this.formSubmit=new V}newPassVisible(){this.isNewPassVisible=!this.isNewPassVisible}confirmNewPassVisible(){this.isConfirmNewPassVisible=!this.isConfirmNewPassVisible}checkPasswordMatch(){this.data.newPassword&&this.data.confirmNewPassword&&(this.passwordMismatch=this.data.newPassword!==this.data.confirmNewPassword,this.passwordMismatch?this.message="Password baru tidak sama":this.message="")}onSubmit(){this.form.valid&&this.formSubmit.emit(this.data)}static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275cmp=h({type:r,selectors:[["app-reset-password-form"]],viewQuery:function(e,t){if(e&1&&O(Fe,5),e&2){let n;F(n=T())&&(t.form=n.first)}},inputs:{data:"data"},outputs:{formSubmit:"formSubmit"},decls:17,vars:10,consts:[["form","ngForm"],["newPassword","ngModel"],["confirmNewPassword","ngModel"],[1,"form-container"],[1,"form",3,"ngSubmit"],["pageTitle","Reset Password"],[1,"input-container"],["label","Password baru","autocomplete","new-password","inputMode","text","placeholder","Password baru","name","newPassword","required","","minLength","8","minLengthErrorMessage","Password harus berisi minimal 8 karakter dengan kombinasi huruf besar, huruf kecil, dan angka","pattern","^(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9]).+$","patternErrorMessage","Password harus berisi minimal 8 karakter dengan kombinasi huruf besar, huruf kecil, dan angka",1,"input",3,"ngModelChange","togglePassClick","type","ngModel","isPassVisible","isRequired"],["label","Konfirmasi Password Baru","autocomplete","new-password","inputMode","text","placeholder","Konfirmasi password baru","name","confirmNewPassword","required","","minLength","8","minlength","8","minLengthErrorMessage","Password harus berisi minimal 8 karakter dengan kombinasi huruf besar, huruf kecil, dan angka","pattern","^(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9]).+$","patternErrorMessage","Password harus berisi minimal 8 karakter dengan kombinasi huruf besar, huruf kecil, dan angka",1,"input",3,"ngModelChange","togglePassClick","type","ngModel","isPassVisible","isRequired"],[1,"error-message-container"],["class","error-message",4,"ngIf"],[1,"buttons-container"],["type","button","routerLink","/dashboard",1,"button"],["type","submit",1,"button",3,"disabled"],[1,"error-message"]],template:function(e,t){if(e&1){let n=E();o(0,"app-auth")(1,"div",3)(2,"form",4,0),c("ngSubmit",function(){return g(n),f(t.onSubmit())}),C(4,"app-title",5),o(5,"div",6)(6,"app-base-input",7,1),k("ngModelChange",function(d){return g(n),M(t.data.newPassword,d)||(t.data.newPassword=d),f(d)}),c("togglePassClick",function(){return g(n),f(t.newPassVisible())})("ngModelChange",function(){return g(n),f(t.checkPasswordMatch())}),s(),o(8,"app-base-input",8,2),k("ngModelChange",function(d){return g(n),M(t.data.confirmNewPassword,d)||(t.data.confirmNewPassword=d),f(d)}),c("togglePassClick",function(){return g(n),f(t.confirmNewPassVisible())})("ngModelChange",function(){return g(n),f(t.checkPasswordMatch())}),s(),o(10,"div",9),R(11,Te,2,1,"span",10),s()(),o(12,"div",11)(13,"app-white-button",12),p(14,"Kembali"),s(),o(15,"app-blue-button",13),p(16,"Simpan"),s()()()()()}if(e&2){let n=L(3);u(6),l("type",t.isNewPassVisible?"text":"password"),y("ngModel",t.data.newPassword),l("isPassVisible",t.isNewPassVisible)("isRequired",!0),u(2),l("type",t.isConfirmNewPassVisible?"text":"password"),y("ngModel",t.data.confirmNewPassword),l("isPassVisible",t.isConfirmNewPassVisible)("isRequired",!0),u(3),l("ngIf",t.passwordMismatch&&n.valid),u(4),l("disabled",n.invalid||t.passwordMismatch)}},dependencies:[H,Q,Y,$,z,S,U,I,q,W,be,ve,D,B,_,A,j],styles:[".form-container[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;align-items:center;justify-content:center}.buttons-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:4em;width:100%;margin-top:2em}.button[_ngcontent-%COMP%]{width:190px;height:45px}.reset-password-message[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;background-color:#90ee90;padding:2px;position:relative;top:1em;color:#000;font-weight:700}.error-message[_ngcontent-%COMP%]{color:red;margin-left:15px;margin-top:3px;font-size:14px}",".form-container[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;align-items:center;justify-content:center}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;width:75%;padding:0 2em}.input-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%}.buttons-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:4em;width:100%;margin-top:2em}.button[_ngcontent-%COMP%]{width:190px;height:45px}.input[_ngcontent-%COMP%]{width:100%}.isRegistered[_ngcontent-%COMP%]{margin-top:25px;font-weight:700}.isRegistered[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#02507e}.error-message-container[_ngcontent-%COMP%]{width:100%}.error-message[_ngcontent-%COMP%]{color:red;margin-left:15px;margin-top:3px;font-size:14px}.success-message[_ngcontent-%COMP%]{background-color:#90ee90;padding:2px;margin-top:3px;color:#000}.register-message[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;background-color:#90ee90;padding:2px;position:relative;top:1em;color:#000;font-weight:700}@media (max-width: 768px){.form[_ngcontent-%COMP%]{width:100%}}"]})}}return r})();var ae=(()=>{class r{constructor(i,e,t,n,a){this.route=i,this.router=e,this.authService=t,this.sweetalertService=n,this.errorHandlerService=a,this.data={token:this.route.snapshot.paramMap.get("token")||"",newPassword:"",confirmNewPassword:""}}onResetPassword(i){this.authService.resetPassword(i).subscribe({next:()=>{this.sweetalertService.alert("Berhasil!","Password berhasil diperbarui","success"),this.router.navigateByUrl("/login")},error:e=>{console.log(e),console.log(e),this.errorHandlerService.alertError(e)}})}static{this.\u0275fac=function(e){return new(e||r)(m(N),m(w),m(b),m(v),m(x))}}static{this.\u0275cmp=h({type:r,selectors:[["app-reset-password"]],decls:1,vars:1,consts:[[3,"formSubmit","data"]],template:function(e,t){e&1&&(o(0,"app-reset-password-form",0),c("formSubmit",function(a){return t.onResetPassword(a)}),s()),e&2&&l("data",t.data)},dependencies:[ke],encapsulation:2})}}return r})();var G=(()=>{class r{constructor(i,e,t,n,a){this.authService=i,this.sweetalertService=e,this.errorHandlerService=t,this.route=n,this.router=a,this.data={email:""},this.message=""}ngOnInit(){this.route.queryParams.subscribe(i=>{let e=i.token;e&&this.verifyAccount(e);let t=sessionStorage.getItem("unverified_email");t&&(this.data.email=t,sessionStorage.removeItem("unverified_email"))})}onSubmit(i){this.sweetalertService.loading("Mohon tunggu","Proses..."),this.authService.resendVerification(i.email).subscribe({next:()=>{this.sweetalertService.close(),this.sweetalertService.alert("Berhasil","Tautan verifikasi telah dikirim ke email Anda. Periksa kotak masuk/spam.","success")},error:e=>{this.sweetalertService.close(),console.log(e),this.errorHandlerService.alertError(e)}})}verifyAccount(i){this.sweetalertService.loading("Mohon tunggu","Memverifikasi akun Anda..."),this.authService.verifyAccount(i).subscribe({next:e=>{this.sweetalertService.close(),this.sweetalertService.alert("Verifikasi Berhasil","Akun berhasil diverifikasi. Mengarahkan ke Dashboard...","success").then(()=>{this.authService.me().pipe(ce(t=>{this.authService.setUserProfile(t.data),console.log("AccountVerificationComponent: User profile updated in localStorage via authService.me()",this.authService.getUserProfile())})).subscribe({complete:()=>{console.log("AccountVerificationComponent: Navigating to dashboard after successful verification and profile update."),this.router.navigateByUrl("/dashboard")},error:t=>{console.error("AccountVerificationComponent: Error fetching updated user profile:",t),this.router.navigateByUrl("/dashboard")}})})},error:e=>{this.sweetalertService.close(),e.status===400&&e.error?.message?.includes("Token tidak valid atau telah kadaluarsa")?this.sweetalertService.alert("Verifikasi Gagal","Tautan verifikasi tidak valid/kadaluarsa. Minta tautan baru di bawah.","error"):this.errorHandlerService.alertError(e)}})}static{this.\u0275fac=function(e){return new(e||r)(m(b),m(v),m(x),m(N),m(w))}}static{this.\u0275cmp=h({type:r,selectors:[["app-account-verification"]],decls:1,vars:1,consts:[["pageTitle","Account Verification",3,"formSubmit","data"]],template:function(e,t){e&1&&(o(0,"app-email-form",0),c("formSubmit",function(a){return t.onSubmit(a)}),s()),e&2&&l("data",t.data)},dependencies:[oe],encapsulation:2})}}return r})();var de=(r,me)=>{let i=Z(w),e=Z(v),t=Z(b),n="/auth/login",a=()=>(i.navigateByUrl(n),!1);return t.getUserProfile()?(i.navigateByUrl("/dashboard"),!1):!0};var Le=[{path:"login",component:re,canActivate:[de]},{path:"register",component:ne,canActivate:[de]},{path:"password-reset",component:se},{path:"reset/:token",component:ae},{path:"verification",component:G},{path:"verify",component:G},{path:"",redirectTo:"login",pathMatch:"full"}],xe=(()=>{class r{static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275mod=J({type:r})}static{this.\u0275inj=K({imports:[le.forChild(Le),le]})}}return r})();var ri=(()=>{class r{static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275mod=J({type:r})}static{this.\u0275inj=K({imports:[_,S,Ce,xe,re,ne,se,ae,G]})}}return r})();export{ri as AuthModule};
