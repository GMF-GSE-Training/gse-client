import{a as j}from"./chunk-66ZF4XVS.js";import{a as i,b as $}from"./chunk-MHBMZNY6.js";import{A as G,g as w,h as b,k as R,l as k,o as S,q as x,r as c,u as y,v as T,w as D,y as E,z as I}from"./chunk-X3JFI3RT.js";import{A as g,B as h,M as d,N as v,Sa as C,X as s,Xa as M,l as m,m as f,pb as A,q as u}from"./chunk-NQSGFRSF.js";var F=[{path:"",pathMatch:"full",redirectTo:"dashboard"},{path:"auth",loadChildren:()=>import("./chunk-6UDLHYZO.js").then(t=>t.AuthModule)},{path:"login",redirectTo:"auth/login",pathMatch:"full"},{path:"register",redirectTo:"auth/register",pathMatch:"full"},{path:"password-reset",redirectTo:"auth/password-reset",pathMatch:"full"},{path:"reset/:token",redirectTo:"auth/reset/:token",pathMatch:"full"},{path:"verification",redirectTo:"auth/verification",pathMatch:"full"},{path:"verify",redirectTo:"auth/verify",pathMatch:"full"},{path:"dashboard",loadChildren:()=>import("./chunk-ITBXVMXQ.js").then(t=>t.DashboardModule)},{path:"participants",loadChildren:()=>import("./chunk-FCQAVKLM.js").then(t=>t.ParticipantModule),canActivate:[i]},{path:"capability",loadChildren:()=>import("./chunk-LHMS54OE.js").then(t=>t.CapabilityModule),canActivate:[i,$,j],data:{roles:["super admin","supervisor","lcu","user"]}},{path:"cot",loadChildren:()=>import("./chunk-IXD2GS5Q.js").then(t=>t.CotModule),canActivate:[i]},{path:"users",loadChildren:()=>import("./chunk-JPSQQRP6.js").then(t=>t.UsersModule),canActivate:[i]},{path:"e-sign",loadChildren:()=>import("./chunk-QYWJZ5OD.js").then(t=>t.ESignModule),canActivate:[i]},{path:"curriculum-syllabus",loadChildren:()=>import("./chunk-Y2WKJDVX.js").then(t=>t.CurriculumSyllabusModule),canActivate:[i]},{path:"home",redirectTo:"dashboard",pathMatch:"full"},{path:"not-found",loadComponent:()=>import("./chunk-W4GP6QQI.js").then(t=>t.NotFoundComponent)},{path:"**",redirectTo:"not-found"}];var L=(t,a)=>{let e=s(I),o=s(c),p=s(G),n=!1,l=new f(null);return a(t).pipe(h(r=>r.status===401&&!t.url.includes("/token")?U(t,a,e,o,p,n,l):u(()=>r)))},U=(t,a,e,o,p,n,l)=>n?l.pipe(d(r=>r?a(t):(P(o,e),p.alert("Selamat Datang!","Sesi tidak ditemukan, sudah mencoba login?","warning"),u(()=>new Error("Token refresh failed"))))):(n=!0,l.next(null),e.refreshToken().pipe(d(r=>(n=!1,l.next(r.data),a(t))),h(r=>(n=!1,P(o,e),p.alert("Selamat Datang!","Sesi tidak ditemukan, sudah mencoba login?","warning"),o.navigate(["/login"]),u(()=>r))))),P=(t,a)=>{localStorage.clear(),t.navigate(["/login"])};var N={providers:[T(F,D(y)),R(k([L]))]};var O=(()=>{class t{constructor(e){this.router=e,this.title="GMF Aeroasia",this.isAuthRoute=!1,this.destroy$=new m,this.excludedRoutes=["/login","/register","/password-reset","/verification","/users/add","/auth/login","/auth/register","/auth/password-reset","/auth/verification"],this.excludedRoutesRegex=[/^\/users\/[a-f0-9\-]+\/edit(\?.*)?$/,/^\/reset\/[^/]+(\?.*)?$/]}ngOnInit(){this.checkCurrentRoute(),this.router.events.pipe(g(e=>e instanceof S),v(this.destroy$)).subscribe(()=>this.checkCurrentRoute())}checkCurrentRoute(){let e=this.router.url.split("?")[0];this.isAuthRoute=this.excludedRoutes.includes(e)||this.excludedRoutesRegex.some(o=>o.test(e))}static{this.\u0275fac=function(o){return new(o||t)(C(c))}}static{this.\u0275cmp=M({type:t,selectors:[["app-root"]],decls:1,vars:0,template:function(o,p){o&1&&A(0,"router-outlet")},dependencies:[x,w],encapsulation:2})}}return t})();E.production&&(console.log=()=>{},console.debug=()=>{},console.info=()=>{},console.warn=()=>{});b(O,N).catch(t=>console.error(t));
