import{a as M,b as Xe}from"./chunk-L5Q32TU2.js";import{a as D}from"./chunk-3HQGUZBH.js";import{a as et,b as tt}from"./chunk-2WGYRWCL.js";import{a as Ye}from"./chunk-5OBM2AOW.js";import{a as Ze,b as de}from"./chunk-ARR32BXE.js";import{a as ce}from"./chunk-O5IUEWYX.js";import{b as Je}from"./chunk-V4ER26SS.js";import{a as $e}from"./chunk-3FGHHD2R.js";import{b as Re,c as re,d as qe,e as Ae,f as oe,g as je,h as Ve,i as We,j as Ke,k as se,n as Ue,o as O,p as ze,q as He,s as pe,t as Qe,u as le}from"./chunk-WXCNIMRR.js";import{b as Ge}from"./chunk-LHQWWVGU.js";import{a as H}from"./chunk-SX5M3CY2.js";import{a as S,b as w}from"./chunk-7SSAWSJY.js";import{a as E}from"./chunk-37HAY2GT.js";import{B as Ee,C as B,b as Oe,d as z,g as T,p as ae,r as F,t as N,u as ne,z as ye}from"./chunk-IYTWSHJZ.js";import{Ab as Be,Cb as q,Db as A,Eb as j,Fb as De,G as X,Gb as m,Hb as Le,Ja as Me,Ka as U,Kb as P,La as Ie,Lb as b,M as ee,Mb as v,Na as p,Ob as $,Pb as J,Ra as ke,S as te,Sa as d,Xa as y,Ya as ie,a as W,ab as _,b as K,ba as u,ca as g,e as be,f as ve,hb as s,ib as Te,jb as I,ka as Ce,nb as r,o as Se,oa as xe,ob as o,pb as C,sb as k,t as we,vb as h,wb as l,xb as Fe,yb as Ne}from"./chunk-VF5RWILG.js";var ue=(()=>{class n{constructor(e,t,i,a){this.participantService=e,this.sweetalertService=t,this.router=i,this.route=a,this.pageTitle="Participants",this.columns=[{header:"No Pegawai",field:"idNumber"},{header:"Nama",field:"name"},{header:"Dinas",field:"dinas"},{header:"Bidang",field:"bidang"},{header:"Perusahaan",field:"company"},{header:"Email",field:"email"},{header:"Action",field:"action"}],this.participants=[],this.isLoading=!1,this.currentPage=1,this.totalPages=1,this.itemsPerPage=10,this.searchQuery="",this.placeHolder="Cari Participant",this.roleBassedAccess=["super admin","supervisor","lcu"]}ngOnInit(){this.route.queryParams.subscribe(e=>{this.searchQuery=e.keyword||"",this.currentPage=+e.page||1,this.getListParticipants(this.searchQuery,this.currentPage,this.itemsPerPage)})}getListParticipants(e,t,i){this.isLoading=!0,this.participantService.listParticipants(e,t,i).subscribe({next:a=>{this.participants=this.mapParticipants(a),this.totalPages=a.paging?.totalPage??1},error:a=>{console.log(a),this.sweetalertService.alert("Pemberitahuan","Server sedang sibuk atau terjadi gangguan. Silakan coba beberapa saat lagi.","error"),this.isLoading=!1},complete:()=>{this.isLoading=!1}})}deleteParticipant(e){return ve(this,null,function*(){(yield this.sweetalertService.confirm("Anda Yakin?",`Apakah anda ingin menghapus peserta ini : ${e.name}?`,"warning","Ya, hapus!"))&&(this.sweetalertService.loading("Mohon tunggu","Proses..."),this.participantService.deleteParticipant(e.id).subscribe({next:()=>{this.sweetalertService.alert("Dihapus!","Data peserta berhasil dihapus","success"),this.participants=this.participants.filter(a=>a.id!==e.id),this.participants.length===0&&this.currentPage>0&&(this.currentPage-=1),this.getListParticipants(this.searchQuery,this.currentPage,this.itemsPerPage),this.currentPage>this.totalPages&&(this.currentPage=this.totalPages);let i=this.searchQuery?{keyword:this.searchQuery,page:this.currentPage}:{page:this.currentPage};this.router.navigate([],{relativeTo:this.route,queryParams:i,queryParamsHandling:"merge"})},error:i=>{console.log(i),this.sweetalertService.alert("Gagal!","Terjadi kesalahan, coba lagi nanti","error")}}))})}onSearchChanged(e){e.trim()===""?this.router.navigate([],{queryParams:{keyword:null,page:null},queryParamsHandling:"merge"}):this.router.navigate([],{queryParams:{keyword:e,page:1},queryParamsHandling:"merge"})}onPageChanged(e){this.router.navigate([],{queryParams:{page:e},queryParamsHandling:"merge"})}viewAll(){this.participants.length>0,this.router.navigate([],{relativeTo:this.route,queryParams:{keyword:void 0,page:void 0},queryParamsHandling:"merge"}),this.searchQuery=""}mapParticipants(e){return e.data.map(t=>K(W({},t),{idNumber:t.idNumber??"-",dinas:t.dinas??"-",bidang:t.bidang??"-",company:t.company??"-",editLink:e.actions?.canEdit?`/participants/${t.id}/edit`:null,detailLink:e.actions?.canView?`/participants/${t.id}/detail`:null,deleteMethod:e.actions?.canDelete?()=>this.deleteParticipant(t):null}))}static{this.\u0275fac=function(t){return new(t||n)(d(M),d(B),d(N),d(F))}}static{this.\u0275cmp=y({type:n,selectors:[["app-participant-list"]],decls:2,vars:9,consts:[[3,"pageChange","searchChange","viewAllChange","pageTitle","columns","data","isLoading","totalPages","currentPage","placeHolder","blueButtonRoute","roleBassedAccess"]],template:function(t,i){t&1&&(C(0,"app-header"),r(1,"app-data-management",0),h("pageChange",function(c){return i.onPageChanged(c)})("searchChange",function(c){return i.onSearchChanged(c)})("viewAllChange",function(){return i.viewAll()}),o()),t&2&&(p(),s("pageTitle",i.pageTitle)("columns",i.columns)("data",i.participants)("isLoading",i.isLoading)("totalPages",i.totalPages)("currentPage",i.currentPage)("placeHolder",i.placeHolder)("blueButtonRoute","/participants/add")("roleBassedAccess",i.roleBassedAccess))},dependencies:[Je,H],encapsulation:2})}}return n})();var lt=["*"];function ct(n,f){n&1&&(r(0,"span"),m(1,"*"),o())}function dt(n,f){if(n&1){let e=k();r(0,"input",7),v("ngModelChange",function(i){u(e);let a=l();return b(a.companyName,i)||(a.companyName=i),g(i)}),o()}if(n&2){let e=l();s("name",e.name)("required",e.showCompanyInput),P("ngModel",e.companyName)}}var V=(()=>{class n{constructor(){this.selectedCompany="",this.showCompanyInput=!1,this.companyName="",this.name="",this.isRequired=!1}ngOnInit(){this.selectedCompany||(this.selectedCompany="GMF",this.toggleCompanyInput())}toggleCompanyInput(){this.showCompanyInput=this.selectedCompany==="Non GMF"}getCompanyName(){return this.selectedCompany==="Non GMF"?this.companyName:"GMF"}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=y({type:n,selectors:[["app-company-input"]],inputs:{selectedCompany:"selectedCompany",showCompanyInput:"showCompanyInput",companyName:"companyName",name:"name",isRequired:"isRequired"},ngContentSelectors:lt,decls:11,vars:3,consts:[[1,"container"],["for","company-select"],[4,"ngIf"],["id","company-select",3,"ngModelChange","change","ngModel"],["value","GMF"],["value","Non GMF"],["type","text","id","company-input","placeholder","Nama Perusahaan",3,"name","required","ngModel","ngModelChange",4,"ngIf"],["type","text","id","company-input","placeholder","Nama Perusahaan",3,"ngModelChange","name","required","ngModel"]],template:function(t,i){t&1&&(Fe(),r(0,"div",0)(1,"label",1),m(2,"Perusahaan "),_(3,ct,2,0,"span",2),o(),r(4,"select",3),v("ngModelChange",function(c){return b(i.selectedCompany,c)||(i.selectedCompany=c),c}),h("change",function(){return i.toggleCompanyInput()}),r(5,"option",4),m(6,"GMF"),o(),r(7,"option",5),m(8,"Non GMF"),o()(),_(9,dt,1,3,"input",6),Ne(10),o()),t&2&&(p(3),s("ngIf",i.isRequired),p(),P("ngModel",i.selectedCompany),p(5),s("ngIf",i.showCompanyInput))},dependencies:[O,We,Ke,Re,Ve,re,se,oe,T,z],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column}label[_ngcontent-%COMP%]{display:flex;margin-top:15px;font-weight:700;font-size:1em}select[_ngcontent-%COMP%], input[_ngcontent-%COMP%]{display:flex;align-items:center;border-radius:25px;overflow:hidden;width:100%;margin-top:5px;border:3px solid #ccc;height:40px;font-weight:700;padding-left:8px;font-size:15px}span[_ngcontent-%COMP%]{color:red}@media (max-width: 768px){input[_ngcontent-%COMP%]{border:2px solid #ccc}}"]})}}return n})();var mt=["form"];function ut(n,f){n&1&&C(0,"app-loader")}function gt(n,f){n&1&&(r(0,"span",39),m(1,"SIM A wajib diunggah"),o())}function ht(n,f){n&1&&(r(0,"span",39),m(1,"KTP wajib diunggah"),o())}function ft(n,f){n&1&&(r(0,"span",39),m(1,"Pas Foto wajib diunggah"),o())}function _t(n,f){n&1&&(r(0,"span",39),m(1,"Surat Ket. Sehat dan Buta Warna wajib diunggah"),o())}function Ct(n,f){n&1&&(r(0,"span",39),m(1,"Surat Ket. Bebas Narkoba wajib diunggah"),o())}function yt(n,f){if(n&1){let e=k();r(0,"div",10),C(1,"app-title",11),r(2,"form",12,0),h("ngSubmit",function(){u(e);let i=l();return g(i.onSubmit())}),r(4,"div",13)(5,"div",14)(6,"app-base-input",15),v("ngModelChange",function(i){u(e);let a=l();return b(a.participant.idNumber,i)||(a.participant.idNumber=i),g(i)}),o(),r(7,"app-base-input",16,1),v("ngModelChange",function(i){u(e);let a=l();return b(a.participant.name,i)||(a.participant.name=i),g(i)}),o(),r(9,"app-base-input",17,2),v("ngModelChange",function(i){u(e);let a=l();return b(a.participant.nik,i)||(a.participant.nik=i),g(i)}),o(),r(11,"app-base-input",18),v("ngModelChange",function(i){u(e);let a=l();return b(a.participant.dinas,i)||(a.participant.dinas=i),g(i)}),o(),r(12,"app-base-input",19),v("ngModelChange",function(i){u(e);let a=l();return b(a.participant.bidang,i)||(a.participant.bidang=i),g(i)}),o(),C(13,"app-company-input",20),r(14,"app-base-input",21,3),v("ngModelChange",function(i){u(e);let a=l();return b(a.participant.email,i)||(a.participant.email=i),g(i)}),o(),r(16,"app-base-input",22,4),v("ngModelChange",function(i){u(e);let a=l();return b(a.participant.phoneNumber,i)||(a.participant.phoneNumber=i),g(i)}),o(),r(18,"app-base-input",23,5),v("ngModelChange",function(i){u(e);let a=l();return b(a.participant.nationality,i)||(a.participant.nationality=i),g(i)}),o(),r(20,"app-base-input",24,6),v("ngModelChange",function(i){u(e);let a=l();return b(a.participant.placeOfBirth,i)||(a.participant.placeOfBirth=i),g(i)}),o()(),r(22,"div",25)(23,"app-base-input",26,7),v("ngModelChange",function(i){u(e);let a=l();return b(a.participant.dateOfBirth,i)||(a.participant.dateOfBirth=i),g(i)}),o(),r(25,"app-file-input",27),h("valueChange",function(i){u(e);let a=l();return g(a.onFileChange("simA",i))}),o(),_(26,gt,2,0,"span",28),r(27,"span"),m(28,"Format png, jpg, jpeg, atau pdf."),o(),r(29,"app-file-input",29),h("valueChange",function(i){u(e);let a=l();return g(a.onFileChange("simB",i))}),o(),r(30,"span"),m(31,"Format png, jpg, jpeg, atau pdf."),o(),r(32,"app-file-input",30),h("valueChange",function(i){u(e);let a=l();return g(a.onFileChange("ktp",i))}),o(),_(33,ht,2,0,"span",28),r(34,"span"),m(35,"Format png, jpg, jpeg, atau pdf."),o(),r(36,"app-file-input",31),h("valueChange",function(i){u(e);let a=l();return g(a.onFileChange("foto",i))}),o(),_(37,ft,2,0,"span",28),r(38,"span"),m(39,"Format png, jpg, atau jpeg. ukuran 3x4."),o(),r(40,"app-file-input",32),h("valueChange",function(i){u(e);let a=l();return g(a.onFileChange("suratSehatButaWarna",i))}),o(),_(41,_t,2,0,"span",28),r(42,"span"),m(43,"Format png, jpg, jpeg, atau pdf."),o(),r(44,"app-base-input",33,8),v("ngModelChange",function(i){u(e);let a=l();return b(a.participant.tglKeluarSuratSehatButaWarna,i)||(a.participant.tglKeluarSuratSehatButaWarna=i),g(i)}),o(),r(46,"app-file-input",34),h("valueChange",function(i){u(e);let a=l();return g(a.onFileChange("suratBebasNarkoba",i))}),o(),_(47,Ct,2,0,"span",28),r(48,"span"),m(49,"Format png, jpg, jpeg, atau pdf."),o(),r(50,"app-base-input",35,9),v("ngModelChange",function(i){u(e);let a=l();return b(a.participant.tglKeluarSuratBebasNarkoba,i)||(a.participant.tglKeluarSuratBebasNarkoba=i),g(i)}),o()()(),r(52,"div",36)(53,"app-white-button",37),m(54,"Kembali"),o(),r(55,"app-blue-button",38),m(56," Simpan "),o()()()()}if(n&2){let e=De(3),t=l();p(),s("pageTitle",t.pageTitle),p(5),P("ngModel",t.participant.idNumber),p(),P("ngModel",t.participant.name),s("isRequired",!0)("restrictToPattern","^[a-zA-Z ]+$")("pattern","^[a-zA-Z ]+$"),p(2),P("ngModel",t.participant.nik),s("isRequired",!0)("restrictToPattern","^[0-9]+$")("pattern","^[0-9]+$"),p(2),P("ngModel",t.participant.dinas),p(),P("ngModel",t.participant.bidang),p(),s("selectedCompany",t.selectedCompany)("companyName",t.companyName)("showCompanyInput",t.showCompanyInput)("isRequired",!0),p(),P("ngModel",t.participant.email),s("isRequired",!0)("disabled",t.isUpdate&&(!t.currentUserRole||t.currentUserRole!=="super admin")),p(2),P("ngModel",t.participant.phoneNumber),s("isRequired",!0)("restrictToPattern","^[0-9-+ ]+$"),p(2),P("ngModel",t.participant.nationality),s("isRequired",!0),p(2),P("ngModel",t.participant.placeOfBirth),s("isRequired",!0),p(3),P("ngModel",t.participant.dateOfBirth),s("isRequired",!0),p(2),s("isRequired",!0)("fileName",t.participant.simAFileName)("fileType",t.fileType)("required",t.participant.simAFileName),p(),s("ngIf",!t.participant.simAFileName&&e.submitted),p(3),s("fileName",t.participant.simBFileName)("fileType",t.fileType),p(3),s("isRequired",!0)("fileName",t.participant.ktpFileName)("fileType",t.fileType),p(),s("ngIf",!t.participant.ktpFileName&&e.submitted),p(3),s("isRequired",!0)("fileName",t.participant.fotoFileName)("fileType",t.fileTypeFoto),p(),s("ngIf",!t.participant.fotoFileName&&e.submitted),p(3),s("isRequired",!0)("fileName",t.participant.suratSehatButaWarnaFileName)("fileType",t.fileType),p(),s("ngIf",!t.participant.suratSehatButaWarnaFileName&&e.submitted),p(3),P("ngModel",t.participant.tglKeluarSuratSehatButaWarna),s("isRequired",!0),p(2),s("isRequired",!0)("fileName",t.participant.suratBebasNarkobaFileName)("fileType",t.fileType),p(),s("ngIf",!t.participant.suratBebasNarkobaFileName&&e.submitted),p(3),P("ngModel",t.participant.tglKeluarSuratBebasNarkoba),s("isRequired",!0),p(3),s("routerLink",t.backButtonRoute),p(2),s("disabled",e.invalid||!t.participant.simA||!t.participant.ktp||!t.participant.foto||!t.participant.suratSehatButaWarna||!t.participant.suratBebasNarkoba)}}var ge=(()=>{class n{constructor(){this.pageTitle="",this.participant={},this.isUpdate=!1,this.isLoading=!1,this.fileType=".png, .jpg, .jpeg, .pdf",this.fileTypeFoto=".png, .jpg, .jpeg",this.formSubmit=new Ce,this.fileChange=new Ce,this.selectedCompany="",this.companyName="",this.showCompanyInput=!1,this.backButtonRoute="/participants",this.cachedUserProfile=JSON.parse(localStorage.getItem("user_profile")||"{}"),this.currentUserRole=this.cachedUserProfile.role?.name}ngOnInit(){this.currentUserRole=this.cachedUserProfile.role?.name}onSubmit(){this.form.valid&&(this.participant.company=this.companyInputComponent.getCompanyName(),this.isUpdate?(this.cachedUserProfile&&this.currentUserRole!=="super admin"&&delete this.participant.email,this.formSubmit.emit(this.participant)):this.formSubmit.emit(this.participant))}onFileChange(e,t){e==="simA"&&(this.participant.simAFileName=t?t.name:null),this.fileChange.emit({property:e,file:t})}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=y({type:n,selectors:[["app-participant-form"]],viewQuery:function(t,i){if(t&1&&(q(V,5),q(mt,5)),t&2){let a;A(a=j())&&(i.companyInputComponent=a.first),A(a=j())&&(i.form=a.first)}},inputs:{pageTitle:"pageTitle",participant:"participant",isUpdate:"isUpdate",isLoading:"isLoading",selectedCompany:"selectedCompany",companyName:"companyName",showCompanyInput:"showCompanyInput",backButtonRoute:"backButtonRoute"},outputs:{formSubmit:"formSubmit",fileChange:"fileChange"},decls:3,vars:1,consts:[["form","ngForm"],["name","ngModel"],["nik","ngModel"],["email","ngModel"],["phoneNumber","ngModel"],["nationality","ngModel"],["placeOfBirth","ngModel"],["dateOfBirth","ngModel"],["tglKeluarSuratSehatButaWarna","ngModel"],["tglKeluarSuratBebasNarkoba","ngModel"],[1,"container"],[3,"pageTitle"],[3,"ngSubmit"],[1,"form-container"],[1,"left-column"],["name","idNumber","label","No Pegawai","placeholder","No Pegawai","type","text","autocomplete","on","inputMode","tel",3,"ngModelChange","ngModel"],["name","name","label","Nama","placeholder","Masukkan nama asli, nama akan digunakan pada data sertifikat","type","text","autocomplete","name","inputMode","text","required","",3,"ngModelChange","ngModel","isRequired","restrictToPattern","pattern"],["name","nik","label","NIK/Paspor","placeholder","Masukkan NIK/Paspor","type","text","autocomplete","off","inputMode","text","required","",3,"ngModelChange","ngModel","isRequired","restrictToPattern","pattern"],["name","dinas","label","Dinas","placeholder","Dinas","type","text","autocomplete","off","inputMode","text",3,"ngModelChange","ngModel"],["name","bidang","label","Bidang","placeholder","Bidang","type","text","autocomplete","off","inputMode","text",3,"ngModelChange","ngModel"],[3,"selectedCompany","companyName","showCompanyInput","isRequired"],["name","email","label","Email","placeholder","Gunakan email aktif","type","email","autocomplete","email","inputMode","text",3,"ngModelChange","ngModel","isRequired","disabled"],["name","phoneNumber","label","Nomor Telepon","placeholder","Gunakan nomor telepon aktif","type","tel","autocomplete","tel","inputMode","tel","pattern","^[0-9+\\- ]+$","required","",3,"ngModelChange","ngModel","isRequired","restrictToPattern"],["name","nationality","label","Kewarganegaraan","placeholder","Isi kewarganegaraan sesuai KTP/Paspor","type","text","autocomplete","country-name","inputMode","text",3,"ngModelChange","ngModel","isRequired"],["name","placeOfBirth","label","Tempat Lahir","placeholder","Isi Tempat Lahir sesuai KTP/Paspor","type","text","autocomplete","address-level2","inputMode","text",3,"ngModelChange","ngModel","isRequired"],[1,"right-column"],["name","dateOfBirth","label","Tanggal Lahir","type","date","inputmode","date","defaultMessage","Isi Tanggal Lahir sesuai KTP/Paspor",3,"ngModelChange","ngModel","isRequired"],["idInput","sim_a_input","label","SIM A",3,"valueChange","isRequired","fileName","fileType","required"],["class","error-message",4,"ngIf"],["idInput","sim_b_input","label","SIM B",3,"valueChange","fileName","fileType"],["idInput","ktp_input","label","KTP/Paspor",3,"valueChange","isRequired","fileName","fileType"],["idInput","foto_input","label","Pas Foto",3,"valueChange","isRequired","fileName","fileType"],["idInput","surat_sehat_input","label","Surat Ket. Sehat dan Buta Warna",3,"valueChange","isRequired","fileName","fileType"],["name","tglKeluarSuratSehatButaWarna","label","Tanggal Pembuatan Surat Ket. Sehat & Buta Warna","defaultMessage","Masukkan tanggal keluar surat sehat sesuai dengan tanggal keluar surat yang diunggah","type","date","inputmode","date","required","",3,"ngModelChange","ngModel","isRequired"],["idInput","surat_bebas_narkoba_input","label","Surat Ket. Bebas Narkoba",3,"valueChange","isRequired","fileName","fileType"],["name","tglKeluarSuratBebasNarkoba","label","Tanggal Pembuatan Surat Ket. Bebas Narkoba","defaultMessage","Masukkan tanggal keluar surat sehat sesuai dengan tanggal keluar surat yang diunggah","type","date","inputmode","date","required","",3,"ngModelChange","ngModel","isRequired"],[1,"buttons-container"],["type","button",1,"button",3,"routerLink"],["type","submit",1,"button",3,"disabled"],[1,"error-message"]],template:function(t,i){t&1&&(C(0,"app-header"),_(1,ut,1,0,"app-loader")(2,yt,57,57,"div",10)),t&2&&(p(),I(i.isLoading?1:2))},dependencies:[Ze,V,le,pe,Qe,ne,O,je,re,qe,se,Ue,oe,Ae,He,T,z,H,ce],styles:[".container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:2em;padding:2em}form[_ngcontent-%COMP%]{background:#fff;padding:2em;border:1px solid #e0e0e0;border-radius:8px;max-width:100%}.form-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%}.left-column[_ngcontent-%COMP%], .right-column[_ngcontent-%COMP%]{width:48%}span[_ngcontent-%COMP%]{margin-left:15px;margin-top:3px;font-size:14px}.error-message[_ngcontent-%COMP%]{color:red}.buttons-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:4em;width:100%;margin-top:2em}.button[_ngcontent-%COMP%]{width:190px;height:45px}@media (max-width: 768px){.container[_ngcontent-%COMP%]{padding:2em 1em}form[_ngcontent-%COMP%]{padding:1em}.form-container[_ngcontent-%COMP%]{display:block}.left-column[_ngcontent-%COMP%], .right-column[_ngcontent-%COMP%]{width:100%}}"]})}}return n})();var he=(()=>{class n{constructor(e,t,i,a){this.router=e,this.participantService=t,this.sweetalertService=i,this.errorHandlerService=a,this.createParticipant={idNumber:"",name:"",nik:"",dinas:"",bidang:"",company:"",email:"",phoneNumber:"",nationality:"",placeOfBirth:"",dateOfBirth:"",simA:null,simAFileName:"",simB:null,simBFileName:"",ktp:null,ktpFileName:"",foto:null,fotoFileName:"",suratSehatButaWarna:null,suratSehatButaWarnaFileName:"",suratBebasNarkoba:null,suratBebasNarkobaFileName:"",tglKeluarSuratSehatButaWarna:"",tglKeluarSuratBebasNarkoba:""},this.requiredFields=["name","company","email","phoneNumber","kewarganegaraan","placeOfBirth","dateOfBirth","simA","ktp","foto","suratSehatButaWarna","tglKeluarSuratSehatButaWarna","suratBebasNarkoba","tglKeluarSuratSehatBebasNarkoba"]}onCreate(e){let t=this.prepareFormData(e);this.sweetalertService.loading("Mohon tunggu","Proses..."),this.participantService.createParticipant(t).subscribe({next:i=>{let a=i.data;this.sweetalertService.alert("Ditambahkan!","Peserta berhasil ditambahkan","success"),this.router.navigateByUrl("/users/add",{state:{id:a.id,idNumber:a.idNumber,nik:a.nik,email:a.email,name:a.name,dinas:a.dinas}})},error:i=>{this.errorHandlerService.alertError(i,this.requiredFields)}})}onFileChange(e,t){if(t){this.createParticipant[e]=t;let i=`${e}FileName`;this.createParticipant[i]=t.name}}prepareFormData(e){let t=new FormData;for(let i in e)if(e.hasOwnProperty(i)){let a=e[i];a==null&&(a=""),(a instanceof File||a)&&t.append(i,a)}return t}static{this.\u0275fac=function(t){return new(t||n)(d(N),d(M),d(B),d(E))}}static{this.\u0275cmp=y({type:n,selectors:[["app-add-participant-data"]],viewQuery:function(t,i){if(t&1&&q(V,5),t&2){let a;A(a=j())&&(i.companyInputComponent=a.first)}},decls:1,vars:2,consts:[[3,"formSubmit","fileChange","pageTitle","participant"]],template:function(t,i){t&1&&(r(0,"app-participant-form",0),h("formSubmit",function(c){return i.onCreate(c)})("fileChange",function(c){return i.onFileChange(c.property,c.file)}),o()),t&2&&s("pageTitle","Add Participant Data")("participant",i.createParticipant)},dependencies:[O,ge],encapsulation:2})}}return n})();var nt=be(Xe());var Pt=()=>["super admin","supervisor","lcu"],bt=()=>["user"],vt=()=>["super admin","lcu","supervisor"],St=()=>["super admin","lcu","user"],at=n=>({active:n}),wt=n=>["/participants",n,"profile","personal"],xt=n=>["/participants",n,"profile","account"];function Mt(n,f){n&1&&C(0,"app-loader")}function It(n,f){n&1&&(r(0,"div",22),m(1,"Data peserta tidak ditemukan."),o())}function kt(n,f){if(n&1&&C(0,"img",5),n&2){let e=l(2);Be("src","data:",e.photoType,"/;base64,",e.pasFoto,"",U)}}function Tt(n,f){if(n&1&&(r(0,"span",23)(1,"span"),m(2,"Cetak Kartu Peserta"),o()()),n&2){let e=l(2);s("routerLink",e.idCardLink)}}function Ft(n,f){if(n&1&&(r(0,"div",24)(1,"div",25),C(2,"i",26),r(3,"span"),m(4,"Data Pribadi"),o()(),r(5,"div",25),C(6,"i",27),r(7,"span"),m(8,"Akun"),o()()()),n&2){let e=l(2);p(),s("ngClass",J(4,at,e.selectedItem===0))("routerLink",J(6,wt,e.id)),p(4),s("ngClass",J(8,at,e.selectedItem===1))("routerLink",J(10,xt,e.id))}}function Nt(n,f){if(n&1){let e=k();r(0,"app-vertical-table",28),h("downloadDocumentClick",function(){u(e);let i=l(2);return g(i.downloadDocument())}),o()}if(n&2){let e=l(2);s("isParticipantDetail",!0)("data",e.verticalTableData)}}function Bt(n,f){if(n&1){let e=k();r(0,"div",17)(1,"div",29)(2,"app-email-form-card",30),h("formSubmit",function(i){u(e);let a=l(2);return g(a.updateEmailSubmit(i))}),o()(),r(3,"div",29)(4,"app-password-update-form-card",31),h("formSubmit",function(i){u(e);let a=l(2);return g(a.updatePasswordSubmit(i))}),o()()()}}function Dt(n,f){if(n&1&&(r(0,"app-white-button",32),m(1,"Kembali"),o()),n&2){let e=l(2);s("routerLink",e.backButtonRoute||"/participants")}}function Lt(n,f){if(n&1&&(r(0,"app-blue-button",32),m(1,"Edit"),o()),n&2){let e=l(2);s("routerLink",e.editLink)}}function Ot(n,f){if(n&1&&(_(0,It,2,0,"div",1),r(1,"div",2)(2,"div",3)(3,"div",4),_(4,kt,1,3,"img",5),o(),r(5,"div",6)(6,"h2"),m(7),o()()(),r(8,"div",7)(9,"div",8),C(10,"img",9),o(),r(11,"div",10),_(12,Tt,3,1,"span",11),r(13,"span")(14,"a",12),m(15,"Download"),o()()()()(),r(16,"div",13),_(17,Ft,9,12,"div",14),r(18,"div",15),_(19,Nt,1,2,"app-vertical-table",16)(20,Bt,5,0,"div",17),o()(),r(21,"div",18),C(22,"app-table",19),o(),r(23,"div",20),_(24,Dt,2,1,"app-white-button",21)(25,Lt,2,1,"app-blue-button",21),o()),n&2){let e=l();s("ngIf",!e.participant&&!e.isLoading),p(4),I(e.pasFoto?4:-1),p(3),Le(e.participant==null?null:e.participant.name),p(3),s("src",e.qrCode,U),p(2),s("appRoleBasedAccess",$(13,Pt)),p(2),s("href",e.qrCode,U)("download",e.qrCodeDownloadName),p(3),s("appRoleBasedAccess",$(14,bt)),p(2),I(e.selectedItem===0?19:e.selectedItem===1?20:-1),p(3),s("columns",e.columns)("data",e.data),p(2),s("appRoleBasedAccess",$(15,vt)),p(),s("appRoleBasedAccess",$(16,St))}}var Q=(()=>{class n{constructor(e,t,i,a,c,x){this.route=e,this.router=t,this.participantService=i,this.authService=a,this.sweetalertService=c,this.errorHandlerService=x,this.participant=null,this.verticalTableData=[],this.editLink="",this.photoType=null,this.backButtonRoute="/participants",this.selectedItem=0,this.isLoading=!1,this.pasFoto=localStorage.getItem("pas_foto"),this.qrCode=localStorage.getItem("qr_code"),this.qrCodeDownloadName="QR_Code.png",this.id=this.route.snapshot.paramMap.get("participantId")||JSON.parse(localStorage.getItem("user_profile")||"{}").participant.id,this.idCardLink="",this.dateOptions={day:"numeric",month:"long",year:"numeric"},this.columns=[{header:"Kompetensi",field:"trainingName"},{header:"Exp Sertifikat",field:"exp"}],this.data=[{trainingName:"Forklift",exp:"10 February 2026"},{trainingName:"Regulasi GSE",exp:"10 February 2026"},{trainingName:"Baggage Towing Tractor",exp:"10 February 2026"},{trainingName:"Air Conditioning System Refreshment",exp:"10 February 2026"}],this.userProfile=JSON.parse(localStorage.getItem("user_profile")||"{}"),this.updateEmail={email:""};let G=this.router.getCurrentNavigation()?.extras.state;G&&(this.backButtonRoute=G.data)}ngOnInit(){this.route.queryParams.subscribe(e=>{e.error?(this.sweetalertService.alert("Gagal",e.error,"error"),this.router.navigate([],{relativeTo:this.route,queryParams:{error:null},queryParamsHandling:"merge"})):e.success&&(this.sweetalertService.alert("Sukses",e.success,"success"),this.getParticipantById(),this.router.navigate([],{relativeTo:this.route,queryParams:{success:null},queryParamsHandling:"merge"}))}),this.route.url.subscribe(e=>{let t=e.map(i=>i.path).join("/");this.selectedItem=t===`participants/${this.id}/profile/personal`?0:t===`participants/${this.id}/profile/account`?1:0}),this.userProfile.role.name==="user"?this.id!==this.userProfile.participant.id?this.getParticipantById():this.getParticipantFromLocalStorage():this.getParticipantById()}getParticipantFromLocalStorage(){this.isLoading=!0,this.participant=this.userProfile.participant,this.participant&&this.setParticipantData(this.participant),this.isLoading=!1}getParticipantById(){this.isLoading=!0,this.participantService.getParticipantById(this.id).subscribe({next:e=>{e.data?this.setParticipantData(e.data):this.participant=null},error:e=>{console.error(e),this.isLoading=!1},complete:()=>{this.isLoading=!1}})}getFoto(e){this.participantService.getFoto(e).pipe(we(t=>new Promise((i,a)=>{let c=new FileReader;c.onloadend=()=>i(c.result),c.onerror=a,c.readAsDataURL(t)})),ee(t=>Se(t))).subscribe({next:t=>{this.photoType=this.getMediaType(t),this.pasFoto=t.split(",")[1],this.userProfile.role.name==="user"&&localStorage.setItem("pas_foto",this.pasFoto)},error:t=>console.error("Error fetching photo:",t)})}getQrCode(e){this.participantService.getQrCode(e).subscribe({next:t=>{let i=new FileReader;i.onloadend=()=>{this.qrCode=i.result,this.userProfile.role.name==="user"&&localStorage.setItem("qr_code",this.qrCode)},i.readAsDataURL(t)},error:t=>console.error("Error fetching QR code:",t)})}downloadDocument(){this.id&&(this.sweetalertService.loading("Mohon tunggu","Proses..."),this.participantService.downloadAllFiles(this.id).subscribe({next:e=>{let t=`AllFiles_${this.participant?.name?.replace(/\s+/g,"_")||"Participant"}_${this.id}.zip`;(0,nt.default)(e,t),this.sweetalertService.close()},error:e=>{this.sweetalertService.close(),this.sweetalertService.alert("Gagal!","Data tidak ditemukan.","error")}}))}updateEmailSubmit(e){this.sweetalertService.loading("Mohon tunggu","Proses..."),this.authService.updateEmailRequest(e).subscribe({next:()=>{this.sweetalertService.alert("Berhasil",`Kami telah mengirimkan email verifikasi ke ${e.email}. Silakan buka tautan untuk menyelesaikan proses.`,"success")},error:t=>this.errorHandlerService.alertError(t)})}updatePasswordSubmit(e){this.sweetalertService.loading("Mohon tunggu","Proses..."),this.authService.updatePassword(e).subscribe({next:()=>{this.sweetalertService.alert("Berhasil","Password berhasil diubah","success")},error:t=>this.errorHandlerService.alertError(t)})}setParticipantData(e){this.participant=e,this.verticalTableData=this.transformData(this.participant),this.editLink=`/participants/${this.id}/edit`,this.idCardLink=`/participants/${this.id}/id-card`,this.qrCodeDownloadName=`QR_Code_${e.name.replace(/ /g,"_")}_${e.id}.png`,this.userProfile.role.name==="user"&&localStorage.setItem("user_profile",JSON.stringify(K(W({},this.userProfile),{participant:this.participant}))),this.participant&&(this.getFoto(this.participant.id),this.getQrCode(this.participant.id))}transformData(e){return[{label:"No Pegawai",value:e.idNumber??"-"},{label:"Nama Peserta",value:e.name},{label:"Dinas",value:e.dinas??"-"},{label:"Bidang",value:e.bidang??"-"},{label:"Perusahaan",value:e.company??"-"},{label:"Email",value:e.email},{label:"No Telp",value:e.phoneNumber??"-"},{label:"Tempat Lahir",value:e.placeOfBirth??"-"},{label:"Tanggal Lahir",value:new Date(e.dateOfBirth).toLocaleDateString("id-ID",this.dateOptions)},{label:"SIM A",link:`/participants/${e.id}/sim-a`},{label:"SIM B",link:`/participants/${e.id}/sim-b`},{label:"KTP",link:`/participants/${e.id}/ktp`},{label:"Exp Surat Sehat & Buta Warna",value:new Date(new Date(e.tglKeluarSuratSehatButaWarna).setMonth(new Date(e.tglKeluarSuratSehatButaWarna).getMonth()+6)).toLocaleDateString("id-ID",this.dateOptions),link:`/participants/${e.id}/surat-sehat-buta-warna`},{label:"Exp Surat Bebas Narkoba",value:new Date(new Date(e.tglKeluarSuratBebasNarkoba).setMonth(new Date(e.tglKeluarSuratBebasNarkoba).getMonth()+6)).toLocaleDateString("id-ID",this.dateOptions),link:`/participants/${e.id}/surat-bebas-narkoba`}]}getMediaType(e){let t=e.match(/data:([a-zA-Z0-9]+\/[a-zA-Z0-9-.+]+).*,.*/);return t&&t.length>0?t[1]:""}static{this.\u0275fac=function(t){return new(t||n)(d(F),d(N),d(M),d(Ee),d(B),d(E))}}static{this.\u0275cmp=y({type:n,selectors:[["app-participant-detail"]],decls:4,vars:3,consts:[[1,"container"],["class","error-message",4,"ngIf"],[1,"section"],[1,"profile-section"],[1,"photo"],["alt","Profile Picture",1,"file",3,"src"],[1,"name"],[1,"qr-section"],[1,"qr-code"],["alt","QR Code",1,"file",3,"src"],[1,"download"],[3,"routerLink",4,"appRoleBasedAccess"],[3,"href","download"],[1,"data-section"],["class","settings-nav",4,"appRoleBasedAccess"],[1,"card"],[3,"isParticipantDetail","data"],[1,"account-form"],[1,"certificate-table"],[3,"columns","data"],[1,"button-container"],["class","button",3,"routerLink",4,"appRoleBasedAccess"],[1,"error-message"],[3,"routerLink"],[1,"settings-nav"],[1,"menu-setting-item",3,"ngClass","routerLink"],[1,"fa-solid","fa-user"],[1,"fa-solid","fa-user-gear"],[3,"downloadDocumentClick","isParticipantDetail","data"],[1,"form-content"],["cardTitle","Ubah Email",3,"formSubmit"],["cardTitle","Ubah Password",3,"formSubmit"],[1,"button",3,"routerLink"]],template:function(t,i){t&1&&(C(0,"app-header"),r(1,"div",0),_(2,Mt,1,0,"app-loader")(3,Ot,26,17),o()),t&2&&(p(),Te("loading",i.isLoading),p(),I(i.isLoading?2:3))},dependencies:[ne,pe,Ye,Ge,$e,T,Oe,z,le,et,tt,ce,H],styles:[".container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:2em;padding:2em}.container.loading[_ngcontent-%COMP%]{justify-content:center;align-items:center;height:50%;width:100%}.section[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:40%}.profile-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.photo[_ngcontent-%COMP%]{max-width:148px;max-height:100%}.name[_ngcontent-%COMP%]{font-size:1em;margin-top:10px}.qr-section[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:1em}.file[_ngcontent-%COMP%]{width:100%;height:100%}.file.blank[_ngcontent-%COMP%]{border:1px solid #fff}.qr-code[_ngcontent-%COMP%]{max-width:180px;max-height:180px}.download[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:25px;font-size:1em;font-weight:700;text-decoration:underline}.data-section[_ngcontent-%COMP%]{display:flex;gap:1em}.settings-nav[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:top;font-size:1em;width:12%}.settings-nav[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{height:50px}.menu-setting-item[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;gap:10px;cursor:pointer;transition:background-color .2s ease,border-left .2s ease}.menu-setting-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-left:1em}.menu-setting-item[_ngcontent-%COMP%]:hover{background-color:#d8dadb}.menu-setting-item.active[_ngcontent-%COMP%]{border-left:5px solid #02507E}.card[_ngcontent-%COMP%]{border:1px solid #e0e0e0;border-radius:8px;height:100%;width:100%;background-color:#fff}.account-form[_ngcontent-%COMP%]{display:flex;padding:20px;gap:5%}.form-content[_ngcontent-%COMP%]{margin:0;width:100%;height:auth;padding-right:10%}.certificate-table[_ngcontent-%COMP%]{width:100%;padding:20px;border:1px solid #e0e0e0;border-radius:8px;background-color:#fff}.button-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:4em;width:100%}.button[_ngcontent-%COMP%]{width:190px;height:45px}.download[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#000}.download[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{cursor:pointer;color:#266e99}.section[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-align:center}.section[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{cursor:pointer;color:#266e99}@media (max-width: 768px){.container[_ngcontent-%COMP%]{padding:1em}.qr-section[_ngcontent-%COMP%]{flex-direction:column}.data-section[_ngcontent-%COMP%]{flex-direction:column;gap:1em}.settings-nav[_ngcontent-%COMP%]{flex-direction:row;width:50%}.menu-setting-item.active[_ngcontent-%COMP%]{border-left:none;border-bottom:5px solid #02507E}.account-form[_ngcontent-%COMP%]{flex-direction:column;gap:3em}}"]})}}return n})();var fe=(()=>{class n{constructor(e,t,i,a,c){this.route=e,this.router=t,this.participantService=i,this.sweetalertService=a,this.errorHandlerService=c,this.updateParticipant={idNumber:"",name:"",nik:"",dinas:"",bidang:"",company:"",phoneNumber:"",nationality:"",placeOfBirth:"",dateOfBirth:"",simA:null,simAFileName:"",simB:null,simBFileName:"",ktp:null,ktpFileName:"",foto:null,fotoFileName:"",suratSehatButaWarna:null,suratSehatButaWarnaFileName:"",suratBebasNarkoba:null,suratBebasNarkobaFileName:"",tglKeluarSuratSehatButaWarna:null,tglKeluarSuratBebasNarkoba:null},this.participantId=this.route.snapshot.paramMap.get("participantId"),this.isLoading=!1,this.selectedCompany="",this.companyName="",this.showCompanyInput=!1,this.requiredFields=["name","company","email","phoneNumber","kewarganegaraan","placeOfBirth","dateOfBirth","simA","ktp","foto","suratSehatButaWarna","tglKeluarSuratSehatButaWarna","suratBebasNarkoba","tglKeluarSuratSehatBebasNarkoba"],this.userProfile=JSON.parse(localStorage.getItem("user_profile")||"{}"),this.id=this.route.snapshot.paramMap.get("participantId")||this.userProfile.participant.id,this.backButtonRoute="/participants"}ngOnInit(){this.participantId&&this.userProfile!=="{}"&&(this.userProfile.role==="user"?this.getParticipantFromLocalStorage():this.getParticipantById()),this.route.queryParams.subscribe(e=>{e.showAlert&&(this.sweetalertService.alert("Peringatan","Anda tidak bisa mengakses halaman lain sebelum melengkapi data","warning"),this.router.navigate([],{relativeTo:this.route,queryParams:{showAlert:null},queryParamsHandling:"merge"}))}),this.id&&this.userProfile.role.name==="user"&&(this.backButtonRoute=`/participants/${this.id}/profile/personal`)}getParticipantFromLocalStorage(){let e=this.userProfile.participant;e&&(this.isLoading=!0,this.setParticipantData(e),this.isLoading=!1)}getParticipantById(){this.participantId&&(this.isLoading=!0,this.participantService.getParticipantById(this.participantId).subscribe({next:e=>{let t=e.data;t&&this.setParticipantData(t)},error:e=>console.log(e),complete:()=>this.isLoading=!1}))}onUpdate(e){if(this.participantId){let t=this.prepareFormData(e);this.sweetalertService.loading("Mohon tunggu","Proses..."),this.participantService.updateParticipant(this.participantId,t).subscribe({next:()=>{this.sweetalertService.alert("Diperbarui!","Peserta berhasil diperbarui","success");let i=this.userProfile.participant;if(i){let a=i.email;this.userProfile.participant=JSON.parse(JSON.stringify(e,(c,x)=>x instanceof File||x===null?void 0:x)),this.userProfile.participant.email=a,this.userProfile.isDataComplete=!0,localStorage.setItem("user_profile",JSON.stringify(this.userProfile))}this.userProfile.role.name==="user"?(localStorage.removeItem("pas_foto"),localStorage.removeItem("qr_code"),this.router.navigateByUrl(`/participants/${this.participantId}/profile/personal`)):this.router.navigateByUrl(`/participants/${this.participantId}/detail`)},error:i=>{console.log(i),this.errorHandlerService.alertError(i,this.requiredFields)}})}}onFileChange(e,t){if(t){this.updateParticipant[e]=t;let i=`${e}FileName`;this.updateParticipant[i]=t.name}}setParticipantData(e){this.updateParticipant=K(W({},e),{dateOfBirth:this.formatDateToISO(e.dateOfBirth),tglKeluarSuratSehatButaWarna:this.formatDateToISO(e.tglKeluarSuratSehatButaWarna),tglKeluarSuratBebasNarkoba:this.formatDateToISO(e.tglKeluarSuratBebasNarkoba)}),this.selectedCompany=e.gmfNonGmf?e.gmfNonGmf:e.company,(e.gmfNonGmf!=="GMF"||e.company!=="GMF")&&(this.companyName=e.company,this.showCompanyInput=!!this.companyName,this.companyName||(this.selectedCompany="GMF",this.companyName="GMF",this.showCompanyInput=!1))}prepareFormData(e){let t=new FormData;for(let i in e)if(e.hasOwnProperty(i)){let a=e[i];a==null&&(a=""),a instanceof File,t.append(i,a)}return t}formatDateToISO(e){return new Date(e).toISOString().split("T")[0]}static{this.\u0275fac=function(t){return new(t||n)(d(F),d(N),d(M),d(B),d(E))}}static{this.\u0275cmp=y({type:n,selectors:[["app-edit-participant-data"]],viewQuery:function(t,i){if(t&1&&q(V,5),t&2){let a;A(a=j())&&(i.companyInputComponent=a.first)}},inputs:{selectedCompany:"selectedCompany",companyName:"companyName",showCompanyInput:"showCompanyInput"},decls:1,vars:8,consts:[[3,"formSubmit","fileChange","pageTitle","selectedCompany","companyName","showCompanyInput","participant","isUpdate","backButtonRoute","isLoading"]],template:function(t,i){t&1&&(r(0,"app-participant-form",0),h("formSubmit",function(c){return i.onUpdate(c)})("fileChange",function(c){return i.onFileChange(c.property,c.file)}),o()),t&2&&s("pageTitle","Edit Participant Data")("selectedCompany",i.selectedCompany)("companyName",i.companyName)("showCompanyInput",i.showCompanyInput)("participant",i.updateParticipant)("isUpdate",!0)("backButtonRoute",i.backButtonRoute)("isLoading",i.isLoading)},dependencies:[ge],encapsulation:2})}}return n})();var rt=be(Xe());function Rt(n,f){if(n&1&&C(0,"div",1),n&2){let e=l();s("innerHTML",e.id_card,Me)}}function qt(n,f){n&1&&(r(0,"div",2)(1,"p"),m(2,"ID Card Error. Silahkan cek kembali apakah data anda sudah lengkap atau belum."),o()())}var _e=(()=>{class n{constructor(e,t,i,a,c){this.route=e,this.participantService=t,this.sanitizer=i,this.sweetalertService=a,this.errorHandlerService=c,this.id_card="",this.id=this.route.snapshot.paramMap.get("participantId"),this.navigationLink=`/participants/${this.id}/detail`,this.isLoading=!1}ngOnInit(){this.getIdCard()}getIdCard(){if(!this.id){this.sweetalertService.alert("Peringatan","ID tidak ditemukan.","warning");return}this.isLoading=!0,this.participantService.viewIdCard(this.id).subscribe({next:e=>{this.id_card=this.sanitizer.bypassSecurityTrustHtml(e)},error:e=>{console.log(e),this.isLoading=!1},complete:()=>{this.isLoading=!1}})}downloadIdCard(){if(!this.id){this.sweetalertService.alert("Peringatan","ID tidak ditemukan.","warning");return}this.sweetalertService.loading("Mohon tunggu","Proses..."),this.participantService.getParticipantById(this.id).pipe(X(()=>this.sweetalertService.close())).subscribe({next:e=>{if(e.data){let a=`ID_Card_${e.data.name.trim().replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_-]/g,"")}_${this.id}.pdf`;this.participantService.downloadIdCard(this.id).subscribe({next:c=>{c?((0,rt.saveAs)(c,a),console.log(`File saved as: ${a}`)):this.sweetalertService.alert("Gagal!","Tidak ada data untuk diunduh.","error")},error:c=>{console.error("Error saat mengunduh ID Card:",c),this.errorHandlerService.alertError(c)}})}else this.sweetalertService.alert("Gagal!","Data peserta tidak ditemukan.","error")},error:e=>{console.error("Error saat mengambil detail peserta:",e),this.errorHandlerService.alertError(e)}})}static{this.\u0275fac=function(t){return new(t||n)(d(F),d(M),d(ae),d(B),d(E))}}static{this.\u0275cmp=y({type:n,selectors:[["app-id-card"]],decls:3,vars:3,consts:[["pageTitle","ID Card",3,"downloadChange","isLoading","navigationLinks"],[3,"innerHTML"],[1,"no-files"]],template:function(t,i){t&1&&(r(0,"app-display-files",0),h("downloadChange",function(){return i.downloadIdCard()}),_(1,Rt,1,1,"div",1)(2,qt,3,0,"div",2),o()),t&2&&(s("isLoading",i.isLoading)("navigationLinks",i.navigationLink),p(),I(i.id_card?1:2))},dependencies:[de],styles:[".no-files[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;font-size:2em;height:50vh}"]})}}return n})();function At(n,f){if(n&1){let e=k();r(0,"embed",4),h("load",function(){u(e);let i=l(2);return g(i.onImageLoad())})("error",function(){u(e);let i=l(2);return g(i.onImageError())}),o()}if(n&2){let e=l(2);s("src",e.safeUrl,Ie)}}function jt(n,f){if(n&1){let e=k();r(0,"img",5),h("load",function(){u(e);let i=l(2);return g(i.onImageLoad())})("error",function(){u(e);let i=l(2);return g(i.onImageError())}),o()}if(n&2){let e=l(2);s("src",e.safeUrl,U)}}function Vt(n,f){if(n&1&&_(0,At,1,1,"embed",2)(1,jt,1,1,"img",3),n&2){let e=l();I(e.fileType==="application/pdf"?0:1)}}function Wt(n,f){n&1&&(r(0,"div",1)(1,"p"),m(2,"File tidak ditemukan!!"),o()())}var R=(()=>{class n{constructor(e,t,i,a,c,x){this.route=e,this.participantService=t,this.router=i,this.sanitizer=a,this.renderer=c,this.el=x,this.pageTitle="",this.id=this.route.snapshot.paramMap.get("participantId"),this.navigationLink="",this.fileType="",this.safeUrl="",this.cachedUserProfile=localStorage.getItem("user_profile"),this.isLoading=!1;let G=this.router.getCurrentNavigation()?.extras.state;G?this.navigationLink=G.data:this.cachedUserProfile&&(JSON.parse(this.cachedUserProfile).role.name==="user"?this.navigationLink=`/participants/${this.id}/profile/personal`:this.navigationLink=`/participants/${this.id}/detail`)}ngOnInit(){let e=this.router.url,i=["sim-a","sim-b","ktp","surat-sehat-buta-warna","surat-bebas-narkoba"].find(a=>e.includes(a));i&&(this.pageTitle=i.toUpperCase().split("-").join(" "),this.id&&this.getFile(this.id,i))}getFile(e,t){this.isLoading=!0,this.participantService.getFile({id:e},t).pipe(ee(i=>(this.fileType=this.getMediaType(i),new Promise((a,c)=>{let x=new FileReader;x.onloadend=()=>a(x.result),x.onerror=c,x.readAsDataURL(i)}))),X(()=>{this.isLoading=!1})).subscribe({next:i=>{this.file=i.split(",")[1],this.fileType==="application/pdf"?this.safeUrl=this.sanitizer.bypassSecurityTrustResourceUrl(`data:${this.fileType};base64,${this.file}#toolbar=0`):this.safeUrl=this.sanitizer.bypassSecurityTrustResourceUrl(`data:${this.fileType};base64,${this.file}`)},error:i=>{console.log(i)}})}onImageLoad(){this.isLoading=!1}onImageError(){console.log("Failed to load image:",this.safeUrl),this.isLoading=!1}getMediaType(e){return e.type==="application/pdf"?"application/pdf":e.type==="image/jpeg"?"image/jpeg":e.type==="image/png"?"image/png":e.type==="image/gif"?"image/gif":e.type==="image/bmp"?"image/bmp":e.type==="image/webp"?"image/webp":"application/octet-stream"}getDownloadExtension(){switch(this.fileType){case"image/png":return".png";case"image/jpeg":return".jpeg";case"image/gif":return".gif";case"image/bmp":return".bmp";case"image/webp":return".webp";case"application/pdf":return".pdf";default:return""}}downloadFile(){if(!this.file||!this.fileType){console.error("File content or type is missing, cannot download.");return}let e=`data:${this.fileType};base64,${this.file}`,t=this.renderer.createElement("a");this.renderer.setAttribute(t,"href",e),this.renderer.setAttribute(t,"download",`${(this.pageTitle||"file").replace(/\s+/g,"_")}${this.getDownloadExtension()}`),this.renderer.appendChild(this.el.nativeElement,t),t.click(),this.renderer.removeChild(this.el.nativeElement,t)}static{this.\u0275fac=function(t){return new(t||n)(d(F),d(M),d(N),d(ae),d(ke),d(xe))}}static{this.\u0275cmp=y({type:n,selectors:[["app-displays-participant-file"]],decls:3,vars:4,consts:[[3,"downloadChange","pageTitle","isLoading","navigationLinks"],[1,"no-files"],["loading","lazy","type","application/pdf",1,"pdf",3,"src"],["loading","lazy",1,"image",3,"src"],["loading","lazy","type","application/pdf",1,"pdf",3,"load","error","src"],["loading","lazy",1,"image",3,"load","error","src"]],template:function(t,i){t&1&&(r(0,"app-display-files",0),h("downloadChange",function(){return i.downloadFile()}),_(1,Vt,2,1)(2,Wt,3,0,"div",1),o()),t&2&&(s("pageTitle",i.pageTitle)("isLoading",i.isLoading)("navigationLinks",i.navigationLink),p(),I(i.safeUrl?1:2))},dependencies:[de,T],styles:[".image[_ngcontent-%COMP%]{max-width:100%;max-height:100%}.pdf[_ngcontent-%COMP%]{width:40%;min-height:100vh}.no-files[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;font-size:2em;height:50vh}a[_ngcontent-%COMP%]{position:relative;color:#266e99;font-weight:700;font-size:22px}a[_ngcontent-%COMP%]{cursor:pointer;text-decoration:underline}a[_ngcontent-%COMP%]:hover{color:purple}"]})}}return n})();var Kt=[{path:"add",component:he,canActivate:[S,w],data:{roles:["super admin","supervisor","lcu"]}},{path:":participantId/detail",component:Q,canActivate:[S,w,D],data:{roles:["super admin","supervisor","lcu"]}},{path:":participantId/profile/personal",component:Q,canActivate:[S,w,D],data:{roles:["user"]}},{path:":participantId/profile/account",component:Q,canActivate:[S,w,D],data:{roles:["user"]}},{path:":participantId/edit",component:fe,canActivate:[S,w],data:{roles:["super admin","lcu","user"]}},{path:":participantId/id-card",component:_e,canActivate:[S,w],data:{roles:["super admin","supervisor","lcu","user"]}},{path:":participantId/sim-a",component:R,canActivate:[S,w,D],data:{roles:["super admin","supervisor","lcu","user"]}},{path:":participantId/sim-b",component:R,canActivate:[S,w,D],data:{roles:["super admin","supervisor","lcu","user"]}},{path:":participantId/ktp",component:R,canActivate:[S,w,D],data:{roles:["super admin","supervisor","lcu","user"]}},{path:":participantId/surat-sehat-buta-warna",component:R,canActivate:[S,w,D],data:{roles:["super admin","supervisor","lcu","user"]}},{path:":participantId/surat-bebas-narkoba",component:R,canActivate:[S,w,D],data:{roles:["super admin","supervisor","lcu","user"]}},{path:"",component:ue,canActivate:[S,w],data:{roles:["super admin","supervisor","lcu","user"]}},{path:"**",redirectTo:"",pathMatch:"full"}],ot=(()=>{class n{static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275mod=ie({type:n})}static{this.\u0275inj=te({imports:[ye.forChild(Kt),ye]})}}return n})();var ma=(()=>{class n{static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275mod=ie({type:n})}static{this.\u0275inj=te({imports:[T,O,ze,ot,ue,he,Q,fe,_e,R]})}}return n})();export{ma as ParticipantModule};
