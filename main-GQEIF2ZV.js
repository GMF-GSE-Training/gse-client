import{a as F}from"./chunk-NOJFPBE5.js";import{a as r,b as j}from"./chunk-OWTYBNTC.js";import{A as G,g as k,h as R,k as T,l as S,o as x,q as y,r as c,u as D,v as E,w as P,y as I,z as $}from"./chunk-E6GS5KQF.js";import{A as C,B as h,M as d,N as M,Sa as A,X as p,Xa as w,l as g,m as v,pb as b,q as u}from"./chunk-NQSGFRSF.js";var U=[{path:"",pathMatch:"full",redirectTo:"dashboard"},{path:"auth",loadChildren:()=>import("./chunk-55D2DN5Z.js").then(t=>t.AuthModule)},{path:"login",redirectTo:"auth/login",pathMatch:"full"},{path:"register",redirectTo:"auth/register",pathMatch:"full"},{path:"password-reset",redirectTo:"auth/password-reset",pathMatch:"full"},{path:"reset/:token",redirectTo:"auth/reset/:token",pathMatch:"full"},{path:"verification",redirectTo:"auth/verification",pathMatch:"full"},{path:"verify",redirectTo:"auth/verify",pathMatch:"full"},{path:"dashboard",loadChildren:()=>import("./chunk-XQMWSXWN.js").then(t=>t.DashboardModule)},{path:"participants",loadChildren:()=>import("./chunk-BIZ7I4EZ.js").then(t=>t.ParticipantModule),canActivate:[r]},{path:"capability",loadChildren:()=>import("./chunk-TB2MREGH.js").then(t=>t.CapabilityModule),canActivate:[r,j,F],data:{roles:["super admin","supervisor","lcu","user"]}},{path:"cot",loadChildren:()=>import("./chunk-XS45UYPG.js").then(t=>t.CotModule),canActivate:[r]},{path:"users",loadChildren:()=>import("./chunk-GQVIQBNW.js").then(t=>t.UsersModule),canActivate:[r]},{path:"e-sign",loadChildren:()=>import("./chunk-DK7PPJON.js").then(t=>t.ESignModule),canActivate:[r]},{path:"curriculum-syllabus",loadChildren:()=>import("./chunk-3RV26HBJ.js").then(t=>t.CurriculumSyllabusModule),canActivate:[r]},{path:"home",redirectTo:"dashboard",pathMatch:"full"},{path:"not-found",loadComponent:()=>import("./chunk-W4GP6QQI.js").then(t=>t.NotFoundComponent)},{path:"**",redirectTo:"not-found"}];var H=(t,i)=>{let e=p($),o=p(c),s=p(G),a=!1,l=new v(null),m=e.getUserProfile()?.accessToken;return m&&(t=t.clone({setHeaders:{Authorization:`Bearer ${m}`}})),i(t).pipe(h(f=>f.status===401&&!t.url.includes("/token")?O(t,i,e,o,s,a,l):u(()=>f)))},O=(t,i,e,o,s,a,l)=>a?l.pipe(d(n=>n?i(t):(B(o,e),s.alert("Selamat Datang!","Sesi tidak ditemukan, sudah mencoba login?","warning"),u(()=>new Error("Token refresh failed"))))):(a=!0,l.next(null),e.refreshToken().pipe(d(n=>(a=!1,l.next(n.data.accessToken||null),i(t))),h(n=>(a=!1,B(o,e),s.alert("Selamat Datang!","Sesi tidak ditemukan, sudah mencoba login?","warning"),o.navigate(["/login"]),u(()=>n))))),B=(t,i)=>{localStorage.clear(),t.navigate(["/login"])};var L={providers:[E(U,P(D)),T(S([H]))]};var N=(()=>{class t{constructor(e){this.router=e,this.title="GMF Aeroasia",this.isAuthRoute=!1,this.destroy$=new g,this.excludedRoutes=["/login","/register","/password-reset","/verification","/users/add","/auth/login","/auth/register","/auth/password-reset","/auth/verification"],this.excludedRoutesRegex=[/^\/users\/[a-f0-9\-]+\/edit(\?.*)?$/,/^\/reset\/[^/]+(\?.*)?$/]}ngOnInit(){this.checkCurrentRoute(),this.router.events.pipe(C(e=>e instanceof x),M(this.destroy$)).subscribe(()=>this.checkCurrentRoute())}checkCurrentRoute(){let e=this.router.url.split("?")[0];this.isAuthRoute=this.excludedRoutes.includes(e)||this.excludedRoutesRegex.some(o=>o.test(e))}static{this.\u0275fac=function(o){return new(o||t)(A(c))}}static{this.\u0275cmp=w({type:t,selectors:[["app-root"]],decls:1,vars:0,template:function(o,s){o&1&&b(0,"router-outlet")},dependencies:[y,k],encapsulation:2})}}return t})();I.production&&(console.log=()=>{},console.debug=()=>{},console.info=()=>{},console.warn=()=>{});R(N,L).catch(t=>console.error(t));
