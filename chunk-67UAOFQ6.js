import{a as D,b as c}from"./chunk-HVBMYJ47.js";import{a as L}from"./chunk-56IKY5DH.js";import"./chunk-O5IUEWYX.js";import"./chunk-3FGHHD2R.js";import{o as v,p as B}from"./chunk-WXCNIMRR.js";import"./chunk-SX5M3CY2.js";import{a as n,b as l}from"./chunk-7SSAWSJY.js";import{a as T}from"./chunk-37HAY2GT.js";import{A as M,C,g as A,l as R,r as F,t as g,z as j}from"./chunk-IYTWSHJZ.js";import{R as w,S as p,Sa as a,W as _,Xa as d,Ya as y,a as o,b as s,hb as h,nb as b,ob as S,vb as f}from"./chunk-VF5RWILG.js";var E=(()=>{class e{constructor(t){this.http=t,this.apiUrl=M.apiUrl,this.endpoints=M.endpoints.curriculumSyllabus}createCurriculumSyllabus(t){return this.http.post(`${this.apiUrl}/${this.endpoints.base}`,t,{withCredentials:!0})}updateCurriculumSyllabus(t,i){return this.http.patch(`${this.apiUrl}/${this.endpoints.base}/${t}`,i,{withCredentials:!0})}static{this.\u0275fac=function(i){return new(i||e)(_(R))}}static{this.\u0275prov=w({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var G=(()=>{class e{constructor(t,i,r,u){this.router=t,this.curriculumSyllabusService=i,this.sweetalertService=r,this.errorHandlerService=u,this.capability={id:"",ratingCode:"",trainingCode:"",trainingName:""},this.regulasiGSEs=[{capabilityId:"",name:"",theoryDuration:0,practiceDuration:0,type:"Regulasi GSE"}],this.kompetensis=[{capabilityId:"",name:"",theoryDuration:0,practiceDuration:0,type:"Kompetensi"}];let m=this.router.getCurrentNavigation()?.extras.state;m&&(this.capability.id=m.id||"",this.capability.ratingCode=m.ratingCode||"",this.capability.trainingName=m.trainingName||"",this.regulasiGSEs[0].capabilityId=this.capability.id,this.kompetensis[0].capabilityId=this.capability.id)}onSubmit(){this.regulasiGSEs=this.regulasiGSEs.map(i=>s(o({},i),{theoryDuration:Number(i.theoryDuration),practiceDuration:Number(i.practiceDuration)})),this.kompetensis=this.kompetensis.map(i=>s(o({},i),{theoryDuration:Number(i.theoryDuration),practiceDuration:Number(i.practiceDuration)}));let t=[...this.regulasiGSEs,...this.kompetensis];this.curriculumSyllabusService.createCurriculumSyllabus({curriculumSyllabus:t}).subscribe({next:i=>{this.sweetalertService.alert("Berhasil",i.data,"success"),this.router.navigateByUrl("/capability")},error:i=>{console.error("Error saving Curriculum & Syllabus",i),this.errorHandlerService.alertError(i)}})}static{this.\u0275fac=function(i){return new(i||e)(a(g),a(E),a(C),a(T))}}static{this.\u0275cmp=d({type:e,selectors:[["app-add-curriculum"]],decls:1,vars:5,consts:[[3,"formSubmit","pageTitle","capability","regulasiGSEs","kompetensis","blueButtonRoute"]],template:function(i,r){i&1&&(b(0,"app-curriculum-syllabus-form",0),f("formSubmit",function(){return r.onSubmit()}),S()),i&2&&h("pageTitle","Add Curriculum & Syllabus")("capability",r.capability)("regulasiGSEs",r.regulasiGSEs)("kompetensis",r.kompetensis)("blueButtonRoute","/capability")},dependencies:[v,D],encapsulation:2})}}return e})();var N=(()=>{class e{constructor(t,i,r,u,k){this.router=t,this.route=i,this.sweetalertService=r,this.capabilityService=u,this.curriculumSyllabusService=k,this.clas="add-button delete-button",this.capability={id:"",ratingCode:"",trainingCode:"",trainingName:""},this.regulasiGSEs=[{id:"",capabilityId:"",name:"",theoryDuration:0,practiceDuration:0,type:""}],this.kompetensis=[{id:"",capabilityId:"",name:"",theoryDuration:0,practiceDuration:0,type:""}],this.capabilityId=this.route.snapshot.paramMap.get("capabilityId"),this.isLoading=!1}ngOnInit(){this.getCapabilityById()}getCapabilityById(){this.capabilityId&&(this.isLoading=!0,this.capabilityService.getCurriculumSyllabus(this.capabilityId).subscribe({next:t=>{if(typeof t.data=="object"){let i=t.data;this.capability={id:i.id,ratingCode:i.ratingCode,trainingCode:i.trainingCode,trainingName:i.trainingName},this.regulasiGSEs=this.mapSyllabus(i.curriculumSyllabus,"Regulasi GSE"),this.kompetensis=this.mapSyllabus(i.curriculumSyllabus,"Kompetensi")}},error:t=>{console.log(t),this.isLoading=!1},complete:()=>{this.isLoading=!1}}))}mapSyllabus(t,i){return t.filter(r=>r.type===i).map(r=>({id:r.id,capabilityId:r.capabilityId,name:r.name,theoryDuration:r.theoryDuration,practiceDuration:r.practiceDuration,type:r.type}))}onSubmit(){this.regulasiGSEs=this.regulasiGSEs.map(i=>s(o({},i),{theoryDuration:Number(i.theoryDuration),practiceDuration:Number(i.practiceDuration)})),this.kompetensis=this.kompetensis.map(i=>s(o({},i),{theoryDuration:Number(i.theoryDuration),practiceDuration:Number(i.practiceDuration)}));let t=[...this.regulasiGSEs,...this.kompetensis];+this.curriculumSyllabusService.updateCurriculumSyllabus(this.capability.id,{curriculumSyllabus:t}).subscribe({next:i=>{this.sweetalertService.alert("Berhasil",i.data,"success"),this.router.navigateByUrl("/capability")},error:i=>{console.error(i)}})}static{this.\u0275fac=function(i){return new(i||e)(a(g),a(F),a(C),a(L),a(E))}}static{this.\u0275cmp=d({type:e,selectors:[["app-edit-curriculum-syllabus"]],decls:1,vars:5,consts:[[3,"formSubmit","pageTitle","capability","regulasiGSEs","kompetensis","isLoading"]],template:function(i,r){i&1&&(b(0,"app-curriculum-syllabus-form",0),f("formSubmit",function(){return r.onSubmit()}),S()),i&2&&h("pageTitle","Edit Curriculum & Syllabus")("capability",r.capability)("regulasiGSEs",r.regulasiGSEs)("kompetensis",r.kompetensis)("isLoading",r.isLoading)},dependencies:[D],styles:[".loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;height:50vh}"]})}}return e})();var K=[{path:"add",component:G,canActivate:[n,l],data:{roles:["super admin"]}},{path:":capabilityId/edit",component:N,canActivate:[n,l],data:{roles:["super admin"]}},{path:":capabilityId/view",component:c,canActivate:[n,l],data:{roles:["super admin","supervisor","lcu","user"]}},{path:"",component:c,canActivate:[n,l],data:{roles:["super admin","supervisor","lcu","user"]}}],$=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=y({type:e})}static{this.\u0275inj=p({imports:[j.forChild(K),j]})}}return e})();var di=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=y({type:e})}static{this.\u0275inj=p({imports:[A,v,B,$,G,N,c]})}}return e})();export{di as CurriculumSyllabusModule};
