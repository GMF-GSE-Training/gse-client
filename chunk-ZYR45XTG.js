import{b as x}from"./chunk-OL7GDQCO.js";import{a as se,b as ae}from"./chunk-2NIR22SJ.js";import{a as ne}from"./chunk-DSFCJ2XM.js";import"./chunk-7FOPSSOG.js";import{b as re}from"./chunk-F36UW5W2.js";import"./chunk-D2SHSVYW.js";import{o as te,p as ie}from"./chunk-2Q7PVCEZ.js";import"./chunk-O7QFMDFQ.js";import{a as A}from"./chunk-447PPADJ.js";import{a as C,b}from"./chunk-6JBBKR6L.js";import{a as _}from"./chunk-I6VJ47DK.js";import{A as h,b as Y,d as K,g as L,j as W,p as P,r as p,s as X,t as Z,x as R,y as j,z as ee}from"./chunk-5LA5AAJX.js";import{A as Q,Gb as F,Na as g,Ob as y,Pb as U,R as V,S as I,Sa as s,W as G,Xa as d,Ya as k,a as M,ab as z,b as $,ba as T,ca as E,f as B,hb as l,nb as o,ob as c,pb as f,sb as J,vb as u,wb as O}from"./chunk-NQSGFRSF.js";var w=(()=>{class i{constructor(e){this.http=e,this.apiUrl=j.apiUrl,this.endpoints=j.endpoints.user}createUser(e){return this.http.post(`${this.apiUrl}/${this.endpoints.base}`,e,{withCredentials:!0})}get(e){return this.http.get(`${this.apiUrl}/${this.endpoints.base}/${e}`,{withCredentials:!0})}updateUser(e,t){return this.http.patch(`${this.apiUrl}/${this.endpoints.base}/${e}`,t,{withCredentials:!0})}listUsers(e,t,r){return this.http.get(`${this.apiUrl}/${this.endpoints.list}?q=${e}&page=${t}&size=${r}`,{withCredentials:!0})}deleteUser(e){return this.http.delete(`${this.apiUrl}/${this.endpoints.base}/${e}`,{withCredentials:!0})}static{this.\u0275fac=function(t){return new(t||i)(G(W))}}static{this.\u0275prov=V({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var ge=()=>["super admin","supervisor","lcu"],oe=(()=>{class i{constructor(e,t,r,n){this.userService=e,this.sweetalertService=t,this.router=r,this.route=n,this.pageTitle="Users",this.columns=[{header:"No Pegawai",field:"idNumber"},{header:"Nama",field:"name"},{header:"Dinas",field:"dinas"},{header:"Role",field:"roleName"},{header:"email",field:"email"},{header:"Action",field:"action"}],this.users=[],this.isLoading=!1,this.currentPage=1,this.itemsPerPage=10,this.totalPages=1,this.searchQuery="",this.isLoadingPagination=!1,this.placeHolder="Cari User"}ngOnInit(){this.route.queryParams.subscribe(e=>{this.searchQuery=e.keyword||"",this.currentPage=+e.page||1,this.getListUsers(this.searchQuery,this.currentPage,this.itemsPerPage)})}getListUsers(e,t,r){this.isLoading=!0,this.isLoadingPagination=!0,this.userService.listUsers(e,t,r).subscribe({next:({data:n,actions:a,paging:m})=>{this.users=n.map(v=>$(M({},v),{idNumber:v.idNumber??"-",dinas:v.dinas??"-",roleName:v.role.name,editLink:a?.canEdit?`/users/${v.id}/edit`:null,deleteMethod:a?.canDelete?()=>this.deleteParticipant(v):null})),this.totalPages=m?.totalPage??1},error:n=>{console.log(n),this.isLoading=!1,this.isLoadingPagination=!1},complete:()=>{this.isLoading=!1,this.isLoadingPagination=!1}})}deleteParticipant(e){return B(this,null,function*(){(yield this.sweetalertService.confirm("Anda Yakin?",`Apakah anda ingin menghapus peserta ini : ${e.idNumber}?`,"warning","Ya, hapus!"))&&(this.sweetalertService.loading("Mohon tunggu","Proses..."),this.userService.deleteUser(e.id).subscribe({next:()=>{this.sweetalertService.alert("Dihapus!","Data peserta berhasil dihapus","success"),this.users=this.users.filter(n=>n.id!==e.id),this.users.length===0&&this.currentPage>0&&(this.currentPage-=1),this.getListUsers(this.searchQuery,this.currentPage,this.itemsPerPage),this.currentPage>this.totalPages&&(this.currentPage=this.totalPages);let r=this.searchQuery?{keyword:this.searchQuery,page:this.currentPage}:{page:this.currentPage};this.router.navigate([],{relativeTo:this.route,queryParams:r,queryParamsHandling:"merge"})},error:r=>{console.log(r),this.sweetalertService.alert("Gagal!","Terjadi kesalahan, coba lagi nanti","error")}}))})}onSearchChanged(e){e.trim()===""?this.router.navigate([],{queryParams:{keyword:null,page:null},queryParamsHandling:"merge"}):this.router.navigate([],{queryParams:{keyword:e,page:1},queryParamsHandling:"merge"})}onPageChanged(e){this.router.navigate([],{queryParams:{page:e},queryParamsHandling:"merge"})}viewAll(){this.router.navigate([],{relativeTo:this.route,queryParams:{keyword:void 0,page:void 0},queryParamsHandling:"merge"}),this.searchQuery=""}static{this.\u0275fac=function(t){return new(t||i)(s(w),s(h),s(p),s(P))}}static{this.\u0275cmp=d({type:i,selectors:[["app-user-list"]],decls:2,vars:11,consts:[[3,"pageChange","searchChange","viewAllChange","pageTitle","columns","data","isLoading","totalPages","currentPage","placeHolder","blueButtonRoute","roleBassedAccess"]],template:function(t,r){t&1&&(f(0,"app-header"),o(1,"app-data-management",0),u("pageChange",function(a){return r.onPageChanged(a)})("searchChange",function(a){return r.onSearchChanged(a)})("viewAllChange",function(){return r.viewAll()}),c()),t&2&&(g(),l("pageTitle",r.pageTitle)("columns",r.columns)("data",r.users)("isLoading",r.isLoading)("totalPages",r.totalPages)("currentPage",r.currentPage)("isLoading",r.isLoadingPagination)("placeHolder",r.placeHolder)("blueButtonRoute","/users/add")("roleBassedAccess",y(10,ge)))},dependencies:[re,A],encapsulation:2})}}return i})();var ce=(()=>{class i{constructor(e,t,r,n){this.router=e,this.userService=t,this.sweetalertService=r,this.errorHandlerService=n,this.createUser={participantId:"",idNumber:"",nik:"",email:"",name:"",password:"",roleId:""},this.requiredFields=["name","nik","email","roleId","password"],this.initialRole="";let m=this.router.getCurrentNavigation()?.extras.state;m&&(this.createUser.participantId=m.id,this.createUser.idNumber=m.idNumber||"",this.createUser.nik=m.nik||"",this.createUser.email=m.email||"",this.createUser.name=m.name||"",this.createUser.dinas=m.dinas||"",this.initialRole="user")}onCreate(e){this.sweetalertService.loading("Mohon tunggu","Proses..."),this.userService.createUser(e).subscribe({next:()=>{this.sweetalertService.alert("Ditambahkan!","Pengguna berhasil ditambahkan","success"),this.router.navigateByUrl("/users")},error:t=>{console.log(t),this.errorHandlerService.alertError(t,this.requiredFields)}})}static{this.\u0275fac=function(t){return new(t||i)(s(p),s(w),s(h),s(_))}}static{this.\u0275cmp=d({type:i,selectors:[["app-add-user"]],decls:1,vars:4,consts:[[3,"formSubmit","isCreate","pageTitle","user","initialRole"]],template:function(t,r){t&1&&(o(0,"app-user-form",0),u("formSubmit",function(a){return r.onCreate(a)}),c()),t&2&&l("isCreate",!0)("pageTitle","Create Account")("user",r.createUser)("initialRole",r.initialRole)},dependencies:[x],encapsulation:2})}}return i})();var me=(()=>{class i{constructor(e,t,r,n,a){this.route=e,this.router=t,this.userService=r,this.sweetalertService=n,this.errorHandlerService=a,this.updateUser={idNumber:"",nik:"",email:"",name:"",password:"",roleId:""},this.userId=this.route.snapshot.paramMap.get("userId")}ngOnInit(){this.getUser()}getUser(){this.userService.get(this.userId).subscribe({next:({data:e})=>{this.updateUser=M({},e)},error:e=>console.log(e)})}onUpdate(e){this.cleanEmptyFields(e),this.userId&&(this.sweetalertService.loading("Mohon tunggu","Proses..."),this.userService.updateUser(this.userId,e).subscribe({next:()=>{this.sweetalertService.alert("Ditambahkan!","Pengguna berhasil diperbarui","success"),this.router.navigateByUrl("/users")},error:t=>{console.log(t),this.errorHandlerService.alertError(t)}}))}cleanEmptyFields(e){for(let t in e)e.hasOwnProperty(t)&&e[t]===""&&(e[t]=null)}static{this.\u0275fac=function(t){return new(t||i)(s(P),s(p),s(w),s(h),s(_))}}static{this.\u0275cmp=d({type:i,selectors:[["app-edit-user"]],decls:1,vars:4,consts:[[3,"formSubmit","isCreate","pageTitle","user","initialRole"]],template:function(t,r){t&1&&(o(0,"app-user-form",0),u("formSubmit",function(a){return r.onUpdate(a)}),c()),t&2&&l("isCreate",!1)("pageTitle","Edit Account")("user",r.updateUser)("initialRole",r.updateUser.roleId)},dependencies:[x],encapsulation:2})}}return i})();var ue=i=>({active:i}),fe=i=>["/users",i,"profile"],de=()=>({exact:!0}),ve=i=>["/users",i,"account"];function Pe(i,he){if(i&1&&f(0,"app-vertical-table",9),i&2){let e=O();l("data",e.verticalTableData)}}function Ce(i,he){if(i&1){let e=J();o(0,"div",10)(1,"div",11)(2,"app-email-form-card",12),u("formSubmit",function(r){T(e);let n=O();return E(n.updateEmailSubmit(r))}),c()(),o(3,"div",11)(4,"app-password-update-form-card",13),u("formSubmit",function(r){T(e);let n=O();return E(n.updatePasswordSubmit(r))}),c()()()}}var q=(()=>{class i{constructor(e,t,r,n,a){this.route=e,this.router=t,this.authService=r,this.sweetalertService=n,this.errorHandlerService=a,this.selectedItem=0,this.userProfile=JSON.parse(localStorage.getItem("user_profile")||"{}"),this.id=this.route.snapshot.paramMap.get("userId")||this.userProfile.id,this.user=null,this.verticalTableData=[]}ngOnInit(){this.routeSubscription=this.route.data.pipe(Q(e=>!!e.tab)).subscribe(e=>{this.selectedItem=e.tab==="account"?1:0}),this.route.queryParams.subscribe(e=>{if(e.error){let t=e.error;this.sweetalertService.alert("Gagal",t,"error"),this.router.navigate([],{relativeTo:this.route,queryParams:{error:null},queryParamsHandling:"merge"})}else if(e.success){let t=e.success;this.sweetalertService.alert("Berhasil",t,"success"),this.getProfile(),this.router.navigate([],{relativeTo:this.route,queryParams:{success:null},queryParamsHandling:"merge"})}}),this.getUserFromLocalStorage()}ngOnDestroy(){this.routeSubscription&&this.routeSubscription.unsubscribe()}getUserFromLocalStorage(){this.user=this.userProfile;let e=this.userProfile;e&&this.setParticipantData(e)}getProfile(){this.authService.me().subscribe({next:e=>{localStorage.setItem("user_profile",JSON.stringify(e.data)),this.getUserFromLocalStorage()},error:e=>{console.log(e)}})}updateEmailSubmit(e){this.sweetalertService.loading("Mohon tunggu","Proses..."),this.authService.updateEmailRequest(e).subscribe({next:()=>{this.sweetalertService.alert("Berhasil",`Kami telah mengirimkan email berisi tautan verifikasi ke email baru Anda (${e.email}). Silahkan buka tautan verifikasi untuk menyelesaikan proses ini`,"success")},error:t=>{console.log(t),this.errorHandlerService.alertError(t)}})}updatePasswordSubmit(e){this.sweetalertService.loading("Mohon tunggu","Proses..."),this.authService.updatePassword(e).subscribe({next:()=>{this.sweetalertService.alert("Berhasil","Password berhasil diubah","success")},error:t=>{console.log(t),this.errorHandlerService.alertError(t)}})}setParticipantData(e){this.user=e,this.verticalTableData=[{label:"No Pegawai",value:this.user.idNumber},{label:"Nama",value:this.user.name},{label:"Dinas",value:this.user.dinas??"-"},{label:"Email",value:this.user.email},{label:"Role",value:this.user.role.name}]}static{this.\u0275fac=function(t){return new(t||i)(s(P),s(p),s(ee),s(h),s(_))}}static{this.\u0275cmp=d({type:i,selectors:[["app-profile"]],decls:15,vars:18,consts:[[1,"container"],[1,"section"],[1,"settings-nav"],["routerLinkActive","active",1,"menu-setting-item",3,"ngClass","routerLink","routerLinkActiveOptions"],[1,"fa-solid","fa-user"],[1,"fa-solid","fa-user-gear"],[1,"card"],[3,"data",4,"ngIf"],["class","account-form",4,"ngIf"],[3,"data"],[1,"account-form"],[1,"form-content"],["cardTitle","Ubah Email",3,"formSubmit"],["cardTitle","Ubah Password",3,"formSubmit"]],template:function(t,r){t&1&&(f(0,"app-header"),o(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3),f(5,"i",4),o(6,"span"),F(7,"Profil"),c()(),o(8,"div",3),f(9,"i",5),o(10,"span"),F(11,"Akun"),c()()(),o(12,"div",6),z(13,Pe,1,1,"app-vertical-table",7)(14,Ce,5,0,"div",8),c()()()),t&2&&(g(4),l("ngClass",U(8,ue,r.selectedItem===0))("routerLink",U(10,fe,r.id))("routerLinkActiveOptions",y(12,de)),g(4),l("ngClass",U(13,ue,r.selectedItem===1))("routerLink",U(15,ve,r.id))("routerLinkActiveOptions",y(17,de)),g(5),l("ngIf",r.selectedItem===0),g(),l("ngIf",r.selectedItem===1))},dependencies:[ne,se,ae,L,Y,K,X,Z,A],styles:[".container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:2em;padding:2em}.section[_ngcontent-%COMP%]{display:flex;gap:1em}.settings-nav[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:top;font-size:1em;width:12%;min-width:150px}.settings-nav[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{height:50px}.menu-setting-item[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;gap:10px;cursor:pointer;padding:10px;border-left:5px solid transparent;transition:all .3s ease;position:relative}.menu-setting-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-left:1em;transition:color .3s ease}.menu-setting-item[_ngcontent-%COMP%]:hover{background-color:#d8dadb}.menu-setting-item.active[_ngcontent-%COMP%]{border-left:5px solid #02507E;background-color:#02507e1a}.menu-setting-item.active[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .menu-setting-item.active[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#02507e}.card[_ngcontent-%COMP%]{border:1px solid #e0e0e0;border-radius:8px;width:100%;height:100%;background-color:#fff;padding:20px}.account-form[_ngcontent-%COMP%]{display:flex;gap:5%}.form-content[_ngcontent-%COMP%]{margin:0;width:100%;height:auto;padding-right:10%}@media (max-width: 768px){.container[_ngcontent-%COMP%]{padding:1em}.section[_ngcontent-%COMP%]{flex-direction:column;gap:1em}.settings-nav[_ngcontent-%COMP%]{flex-direction:row;width:100%;min-width:unset}.menu-setting-item[_ngcontent-%COMP%]{justify-content:center;border-left:none;border-bottom:5px solid transparent}.menu-setting-item.active[_ngcontent-%COMP%]{border-left:none;border-bottom:5px solid #02507E}.menu-setting-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-left:0}.account-form[_ngcontent-%COMP%]{flex-direction:column;gap:3em}.form-content[_ngcontent-%COMP%]{padding-right:0}}"]})}}return i})();var be=[{path:"",component:oe,canActivate:[C,b],data:{roles:["super admin","supervisor"]}},{path:"add",component:ce,canActivate:[C,b],data:{roles:["super admin","supervisor","lcu"]}},{path:":userId/edit",component:me,canActivate:[C,b],data:{roles:["super admin"]}},{path:":userId/profile",component:q,canActivate:[C,b],data:{roles:["super admin","supervisor","lcu"],tab:"profile"}},{path:":userId/account",component:q,canActivate:[C,b],data:{roles:["super admin","supervisor","lcu"],tab:"account"}}],pe=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=k({type:i})}static{this.\u0275inj=I({imports:[R.forChild(be),R]})}}return i})();var Ze=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=k({type:i})}static{this.\u0275inj=I({imports:[L,te,ie,pe]})}}return i})();export{Ze as UsersModule};
