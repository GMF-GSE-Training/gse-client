import{a as F}from"./chunk-6NTE73AM.js";import{a as i,b as j}from"./chunk-VVTHKQVB.js";import{A as G,g as w,h as b,k as T,l as S,o as x,q as y,r as c,u as D,v as E,w as I,y as P,z as $}from"./chunk-V6IZ7FS4.js";import{A as C,B as h,M as d,N as M,Sa as A,X as p,Xa as R,l as g,m as v,pb as k,q as u}from"./chunk-NQSGFRSF.js";var U=[{path:"",pathMatch:"full",redirectTo:"dashboard"},{path:"auth",loadChildren:()=>import("./chunk-INIQFYTE.js").then(t=>t.AuthModule)},{path:"login",redirectTo:"auth/login",pathMatch:"full"},{path:"register",redirectTo:"auth/register",pathMatch:"full"},{path:"password-reset",redirectTo:"auth/password-reset",pathMatch:"full"},{path:"reset/:token",redirectTo:"auth/reset/:token",pathMatch:"full"},{path:"verification",redirectTo:"auth/verification",pathMatch:"full"},{path:"verify",redirectTo:"auth/verify",pathMatch:"full"},{path:"dashboard",loadChildren:()=>import("./chunk-QGLNSO43.js").then(t=>t.DashboardModule)},{path:"participants",loadChildren:()=>import("./chunk-P7FEU4A7.js").then(t=>t.ParticipantModule),canActivate:[i]},{path:"capability",loadChildren:()=>import("./chunk-6CBVSIM4.js").then(t=>t.CapabilityModule),canActivate:[i,j,F],data:{roles:["super admin","supervisor","lcu","user"]}},{path:"cot",loadChildren:()=>import("./chunk-HI3SPAEH.js").then(t=>t.CotModule),canActivate:[i]},{path:"users",loadChildren:()=>import("./chunk-WYUPVCEJ.js").then(t=>t.UsersModule),canActivate:[i]},{path:"e-sign",loadChildren:()=>import("./chunk-CDCCW7LK.js").then(t=>t.ESignModule),canActivate:[i]},{path:"curriculum-syllabus",loadChildren:()=>import("./chunk-33ENLZQ3.js").then(t=>t.CurriculumSyllabusModule),canActivate:[i]},{path:"home",redirectTo:"dashboard",pathMatch:"full"},{path:"not-found",loadComponent:()=>import("./chunk-W4GP6QQI.js").then(t=>t.NotFoundComponent)},{path:"**",redirectTo:"not-found"}];var H=(t,a)=>{let e=p($),o=p(c),s=p(G),n=!1,l=new v(null),m=e.getUserProfile()?.accessToken;return m&&(t=t.clone({setHeaders:{Authorization:`Bearer ${m}`}})),a(t).pipe(h(f=>f.status===401&&!t.url.includes("/token")?O(t,a,e,o,s,n,l):u(()=>f)))},O=(t,a,e,o,s,n,l)=>n?l.pipe(d(r=>r?a(t):(B(o,e),s.alert("Selamat Datang!","Sesi tidak ditemukan, sudah mencoba login?","warning"),u(()=>new Error("Token refresh failed"))))):(n=!0,l.next(null),e.refreshToken().pipe(d(r=>(console.log("AuthInterceptor: Refresh Token Response",r),n=!1,l.next(r.data.accessToken||null),a(t))),h(r=>(n=!1,B(o,e),s.alert("Selamat Datang!","Sesi tidak ditemukan, sudah mencoba login?","warning"),o.navigate(["/login"]),u(()=>r))))),B=(t,a)=>{localStorage.clear(),t.navigate(["/login"])};var L={providers:[E(U,I(D)),T(S([H]))]};var N=(()=>{class t{constructor(e){this.router=e,this.title="GMF Aeroasia",this.isAuthRoute=!1,this.destroy$=new g,this.excludedRoutes=["/login","/register","/password-reset","/verification","/users/add","/auth/login","/auth/register","/auth/password-reset","/auth/verification"],this.excludedRoutesRegex=[/^\/users\/[a-f0-9\-]+\/edit(\?.*)?$/,/^\/reset\/[^/]+(\?.*)?$/]}ngOnInit(){this.checkCurrentRoute(),this.router.events.pipe(C(e=>e instanceof x),M(this.destroy$)).subscribe(()=>this.checkCurrentRoute())}checkCurrentRoute(){let e=this.router.url.split("?")[0];this.isAuthRoute=this.excludedRoutes.includes(e)||this.excludedRoutesRegex.some(o=>o.test(e))}static{this.\u0275fac=function(o){return new(o||t)(A(c))}}static{this.\u0275cmp=R({type:t,selectors:[["app-root"]],decls:1,vars:0,template:function(o,s){o&1&&k(0,"router-outlet")},dependencies:[y,w],encapsulation:2})}}return t})();P.production&&(console.log=()=>{},console.debug=()=>{},console.info=()=>{},console.warn=()=>{});b(N,L).catch(t=>console.error(t));
